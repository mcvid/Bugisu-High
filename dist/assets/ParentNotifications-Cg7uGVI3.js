import{r as d,s as c,j as t,B as x,C as N,I as y,J as z}from"./index-DnZapYtk.js";import{U as R}from"./user-check-BDEA9wcE.js";import{C as q}from"./check-circle-DznmAU8U.js";import{D as H}from"./dollar-sign-gRZTOIu7.js";import{t as A,c as u,n as B,s as h,f as g}from"./format-CPmVBsbA.js";function L(s,i,n){const o=A(s,n==null?void 0:n.in);return isNaN(i)?u(s,NaN):(o.setDate(o.getDate()+i),o)}function b(s){return u(s,Date.now())}function j(s,i,n){const[o,l]=B(n==null?void 0:n.in,s,i);return+h(o)==+h(l)}function T(s,i){return j(u(s,s),b(s))}function W(s,i,n){return L(s,-1,n)}function M(s,i){return j(u(s,s),W(b(s)))}const Y=()=>{const[s,i]=d.useState([]),[n,o]=d.useState(!0),[l,_]=d.useState("all"),[m,O]=d.useState("0700000000");d.useEffect(()=>{f()},[l,m]);const f=async()=>{o(!0);const{data:e}=await c.from("students").select("*").eq("parent_phone",m);if(!e||e.length===0){o(!1);return}const r=e.map(I=>I.id);let a=c.from("notifications").select("*").in("student_id",r).order("created_at",{ascending:!1});l==="unread"?a=a.eq("is_read",!1):l!=="all"&&(a=a.eq("category",l));const{data:C}=await a;i(C||[]),o(!1)},w=async e=>{await c.from("notifications").update({is_read:!0,read_at:new Date().toISOString()}).eq("id",e),f()},v=async()=>{const{data:e}=await c.from("students").select("id").eq("parent_phone",m);if(!e)return;const r=e.map(a=>a.id);await c.from("notifications").update({is_read:!0,read_at:new Date().toISOString()}).in("student_id",r).eq("is_read",!1),f()},D=e=>({fees:H,exams:z,results:q,attendance:R,announcements:x,general:y})[e]||y,S=(e,r)=>r==="urgent"?"#ef4444":r==="high"?"#f59e0b":{fees:"#10b981",exams:"#3b82f6",results:"#8b5cf6",attendance:"#f59e0b",announcements:"#06b6d4",general:"#6b7280"}[e]||"#6b7280",k=e=>{const r=new Date(e);return T(r)?"Today, "+g(r,"HH:mm"):M(r)?"Yesterday, "+g(r,"HH:mm"):g(r,"MMM dd, yyyy HH:mm")},p=s.filter(e=>!e.is_read).length;return t.jsxs("div",{style:{maxWidth:"800px",margin:"0 auto",padding:"20px"},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rem"},children:[t.jsxs("div",{children:[t.jsxs("h1",{style:{margin:0,display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx(x,{size:32,color:"var(--color-orange)"}),"Notifications"]}),t.jsxs("p",{style:{color:"#6b7280",margin:"0.5rem 0 0"},children:[p," unread notification",p!==1?"s":""]})]}),p>0&&t.jsx("button",{className:"btn btn-outline btn-sm",onClick:v,children:"Mark All as Read"})]}),t.jsx("div",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",marginBottom:"1.5rem",overflowX:"auto"},children:["all","unread","fees","exams","results","attendance","announcements"].map(e=>t.jsx("button",{className:`btn btn-sm ${l===e?"btn-primary":"btn-outline"}`,onClick:()=>_(e),style:{textTransform:"capitalize",whiteSpace:"nowrap"},children:e},e))}),n?t.jsx("p",{style:{textAlign:"center",padding:"3rem",color:"#94a3b8"},children:"Loading..."}):s.length===0?t.jsxs("div",{style:{textAlign:"center",padding:"3rem",color:"#94a3b8"},children:[t.jsx(x,{size:48,style:{margin:"0 auto 1rem",opacity:.3}}),t.jsx("p",{children:"No notifications found."})]}):t.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"1rem"},children:s.map(e=>{const r=D(e.category),a=S(e.category,e.priority);return t.jsx("div",{style:{background:e.is_read?"white":"#fffbeb",border:`1px solid ${e.is_read?"#e5e7eb":"#fef3c7"}`,borderLeft:`4px solid ${a}`,borderRadius:"8px",padding:"1.25rem",cursor:e.is_read?"default":"pointer",transition:"all 0.2s"},onClick:()=>!e.is_read&&w(e.id),children:t.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"flex-start"},children:[t.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:`${a}15`,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:t.jsx(r,{size:20,color:a})}),t.jsxs("div",{style:{flex:1},children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"0.5rem"},children:[t.jsxs("div",{children:[t.jsx("span",{style:{fontSize:"0.7rem",textTransform:"uppercase",fontWeight:600,color:a},children:e.category}),e.priority&&e.priority!=="normal"&&t.jsx("span",{style:{marginLeft:"0.5rem",padding:"2px 6px",borderRadius:"4px",background:"#fee2e2",color:"#991b1b",fontSize:"0.65rem",fontWeight:700,textTransform:"uppercase"},children:e.priority})]}),!e.is_read&&t.jsx("div",{style:{width:"8px",height:"8px",borderRadius:"50%",background:a}})]}),t.jsx("p",{style:{margin:"0.5rem 0",color:"#1f2937",lineHeight:1.5,fontWeight:e.is_read?400:600},children:e.message}),t.jsxs("div",{style:{fontSize:"0.75rem",color:"#94a3b8",display:"flex",alignItems:"center",gap:"4px"},children:[t.jsx(N,{size:12}),k(e.created_at)]})]})]})},e.id)})})]})};export{Y as default};
