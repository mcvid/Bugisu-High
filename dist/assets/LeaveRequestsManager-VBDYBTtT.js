import{r as l,s as p,j as e,F as _}from"./index-DqW8wV2_.js";import{U as w}from"./user-CyrY-TM7.js";import{C as g}from"./check-circle-DW4za13M.js";import{X as u}from"./x-circle-CchJBRKL.js";import{C as S}from"./clock-m5u2CMJY.js";import{f as o}from"./format-CPmVBsbA.js";const A=()=>{const[c,h]=l.useState([]),[f,x]=l.useState(!0),[n,a]=l.useState("pending");l.useEffect(()=>{m()},[n]);const m=async()=>{x(!0);let t=p.from("leave_requests").select(`
                *,
                students (
                    student_name,
                    student_reg_number,
                    class_grade,
                    house
                )
            `).order("created_at",{ascending:!1});n!=="all"&&(t=t.eq("status",n));const{data:s,error:r}=await t;r||h(s||[]),x(!1)},b=async t=>{if(!confirm("Approve this leave request?"))return;const{error:s}=await p.from("leave_requests").update({status:"approved",reviewed_at:new Date().toISOString(),reviewed_by:"Admin"}).eq("id",t);s?alert("Error: "+s.message):(alert("Leave request approved!"),m())},j=async t=>{const s=prompt("Reason for rejection (optional):"),{error:r}=await p.from("leave_requests").update({status:"rejected",reviewed_at:new Date().toISOString(),reviewed_by:"Admin",admin_notes:s||""}).eq("id",t);r?alert("Error: "+r.message):(alert("Leave request rejected."),m())},y=t=>{const s={pending:{icon:S,color:"#f59e0b",bg:"#fef3c7",label:"Pending"},approved:{icon:g,color:"#22c55e",bg:"#dcfce7",label:"Approved"},rejected:{icon:u,color:"#ef4444",bg:"#fee2e2",label:"Rejected"}},{icon:r,color:i,bg:d,label:v}=s[t]||s.pending;return e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"4px 12px",borderRadius:"100px",background:d,color:i,fontSize:"0.75rem",fontWeight:600},children:[e.jsx(r,{size:14}),v]})};return e.jsxs("div",{className:"admin-manager",children:[e.jsxs("div",{className:"admin-header",children:[e.jsx("h1",{children:"Leave Requests"}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsxs("button",{className:`btn ${n==="pending"?"btn-primary":"btn-outline"}`,onClick:()=>a("pending"),children:["Pending (",c.filter(t=>t.status==="pending").length,")"]}),e.jsx("button",{className:`btn ${n==="approved"?"btn-primary":"btn-outline"}`,onClick:()=>a("approved"),children:"Approved"}),e.jsx("button",{className:`btn ${n==="rejected"?"btn-primary":"btn-outline"}`,onClick:()=>a("rejected"),children:"Rejected"}),e.jsx("button",{className:`btn ${n==="all"?"btn-primary":"btn-outline"}`,onClick:()=>a("all"),children:"All"})]})]}),e.jsx("div",{className:"admin-content",children:f?e.jsx("p",{children:"Loading leave requests..."}):c.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"3rem",color:"#94a3b8"},children:[e.jsx(_,{size:48,style:{marginBottom:"1rem"}}),e.jsxs("p",{children:["No ",n!=="all"?n:""," leave requests found."]})]}):e.jsx("div",{className:"admin-list",children:c.map(t=>{var s,r,i,d;return e.jsx("div",{className:"admin-list-item",style:{background:"white",padding:"1.5rem",borderRadius:"12px",marginBottom:"1rem",border:"1px solid #e5e7eb"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"1rem"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem"},children:[e.jsx("h3",{style:{margin:0},children:((s=t.students)==null?void 0:s.student_name)||"Unknown Student"}),y(t.status)]}),e.jsxs("div",{style:{display:"flex",gap:"1.5rem",fontSize:"0.85rem",color:"#64748b",marginBottom:"1rem"},children:[e.jsxs("span",{children:[e.jsx(w,{size:14,style:{verticalAlign:"middle",marginRight:"4px"}}),(r=t.students)==null?void 0:r.student_reg_number]}),e.jsxs("span",{children:[(i=t.students)==null?void 0:i.class_grade," â€¢ ",(d=t.students)==null?void 0:d.house]})]}),e.jsxs("div",{style:{background:"#f8fafc",padding:"1rem",borderRadius:"8px",marginBottom:"1rem"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",marginBottom:"0.75rem"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:"0.7rem",color:"#94a3b8",textTransform:"uppercase",fontWeight:600},children:"Leave Type"}),e.jsx("p",{style:{margin:"4px 0 0",fontWeight:500},children:t.leave_type})]}),e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:"0.7rem",color:"#94a3b8",textTransform:"uppercase",fontWeight:600},children:"Duration"}),e.jsxs("p",{style:{margin:"4px 0 0",fontWeight:500},children:[o(new Date(t.start_date),"MMM dd")," - ",o(new Date(t.end_date),"MMM dd, yyyy")]})]})]}),e.jsxs("div",{children:[e.jsx("span",{style:{fontSize:"0.7rem",color:"#94a3b8",textTransform:"uppercase",fontWeight:600},children:"Reason"}),e.jsx("p",{style:{margin:"4px 0 0",lineHeight:1.5},children:t.reason})]})]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"#94a3b8"},children:[e.jsxs("p",{style:{margin:"4px 0"},children:[e.jsx("strong",{children:"Parent:"})," ",t.parent_name," (",t.parent_contact,")"]}),e.jsxs("p",{style:{margin:"4px 0"},children:[e.jsx("strong",{children:"Submitted:"})," ",o(new Date(t.created_at),"MMM dd, yyyy HH:mm")]}),t.reviewed_at&&e.jsxs("p",{style:{margin:"4px 0"},children:[e.jsx("strong",{children:"Reviewed:"})," ",o(new Date(t.reviewed_at),"MMM dd, yyyy HH:mm")," by ",t.reviewed_by]}),t.admin_notes&&e.jsxs("p",{style:{margin:"8px 0 0",padding:"8px",background:"#fee2e2",borderRadius:"4px",color:"#991b1b"},children:[e.jsx("strong",{children:"Admin Notes:"})," ",t.admin_notes]})]})]}),t.status==="pending"&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem",marginLeft:"1rem"},children:[e.jsxs("button",{className:"btn btn-primary btn-sm",onClick:()=>b(t.id),style:{background:"#22c55e",borderColor:"#22c55e",whiteSpace:"nowrap"},children:[e.jsx(g,{size:16})," Approve"]}),e.jsxs("button",{className:"btn btn-outline btn-sm",onClick:()=>j(t.id),style:{color:"#ef4444",borderColor:"#ef4444",whiteSpace:"nowrap"},children:[e.jsx(u,{size:16})," Reject"]})]})]})},t.id)})})})]})};export{A as default};
