import{r as l,s as o,j as e,E as k,U as w,C as A,g as P}from"./index-EH-KDdP-.js";import{A as x}from"./alert-circle-BHhviexG.js";import{f as T}from"./format-CPmVBsbA.js";import{P as g}from"./pen-square-BENuWFf8.js";import{T as z}from"./trash-2-DWd29h3p.js";import{C as E}from"./clock-Da-uQ_oS.js";import{C as I}from"./check-circle-DoFw_Y84.js";const L=()=>{const[u,f]=l.useState([]),[j,p]=l.useState(!0),[y,a]=l.useState(!1),[d,m]=l.useState(null),[t,r]=l.useState({title:"",content:"",priority:"normal",target_audience:"all",target_classes:[],send_sms:!1,send_push:!0,expires_at:""}),b=["Senior 1","Senior 2","Senior 3","Senior 4","Senior 5","Senior 6"];l.useEffect(()=>{c()},[]);const c=async()=>{p(!0);const{data:s,error:n}=await o.from("announcements").select("*").order("created_at",{ascending:!1});n||f(s||[]),p(!1)},v=async s=>{s.preventDefault();try{const n={...t,status:"draft"};d?await o.from("announcements").update(n).eq("id",d):await o.from("announcements").insert([n]),a(!1),m(null),r({title:"",content:"",priority:"normal",target_audience:"all",target_classes:[],send_sms:!1,send_push:!0,expires_at:""}),c()}catch(n){alert("Error saving announcement: "+n.message)}},C=async s=>{if(confirm("Publish this announcement? This will send notifications to the target audience."))try{const{error:n}=await o.rpc("publish_announcement",{announcement_uuid:s});if(n)throw n;alert("Announcement published successfully!"),c()}catch(n){alert("Error publishing: "+n.message)}},_=async s=>{if(!confirm("Delete this announcement? This cannot be undone."))return;const{error:n}=await o.from("announcements").delete().eq("id",s);n||c()},h=s=>{const n={low:"#94a3b8",normal:"#3b82f6",high:"#f59e0b",urgent:"#ef4444"};return n[s]||n.normal},S=s=>{const n={draft:{icon:g,color:"#6b7280",label:"Draft"},published:{icon:I,color:"#22c55e",label:"Published"},scheduled:{icon:E,color:"#3b82f6",label:"Scheduled"},expired:{icon:x,color:"#94a3b8",label:"Expired"}},i=n[s]||n.draft,N=i.icon;return e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:"4px",padding:"4px 10px",borderRadius:"100px",background:`${i.color}15`,color:i.color,fontSize:"0.75rem",fontWeight:600},children:[e.jsx(N,{size:12}),i.label]})};return e.jsxs("div",{className:"admin-manager",children:[e.jsxs("div",{className:"admin-header",children:[e.jsx("h1",{children:"Announcements"}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>{a(!0),m(null)},children:[e.jsx(k,{size:18})," New Announcement"]})]}),y&&e.jsx("div",{className:"modal-overlay",onClick:()=>a(!1),children:e.jsxs("div",{className:"modal-content",style:{maxWidth:"600px"},onClick:s=>s.stopPropagation(),children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h2",{children:d?"Edit Announcement":"New Announcement"}),e.jsx("button",{className:"close-modal",onClick:()=>a(!1),children:"Ã—"})]}),e.jsxs("form",{onSubmit:v,style:{padding:"20px"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Title *"}),e.jsx("input",{type:"text",required:!0,value:t.title,onChange:s=>r({...t,title:s.target.value}),placeholder:"e.g., School Closure Notice"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Content *"}),e.jsx("textarea",{required:!0,rows:5,value:t.content,onChange:s=>r({...t,content:s.target.value}),placeholder:"Full announcement content..."})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Priority"}),e.jsxs("select",{value:t.priority,onChange:s=>r({...t,priority:s.target.value}),children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Target Audience"}),e.jsxs("select",{value:t.target_audience,onChange:s=>r({...t,target_audience:s.target.value}),children:[e.jsx("option",{value:"all",children:"Everyone"}),e.jsx("option",{value:"parents",children:"Parents Only"}),e.jsx("option",{value:"students",children:"Students Only"}),e.jsx("option",{value:"specific_class",children:"Specific Class"})]})]})]}),t.target_audience==="specific_class"&&e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Select Classes"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.5rem"},children:b.map(s=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:t.target_classes.includes(s),onChange:n=>{n.target.checked?r({...t,target_classes:[...t.target_classes,s]}):r({...t,target_classes:t.target_classes.filter(i=>i!==s)})}}),s]},s))})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Expires On (Optional)"}),e.jsx("input",{type:"datetime-local",value:t.expires_at,onChange:s=>r({...t,expires_at:s.target.value})})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:t.send_push,onChange:s=>r({...t,send_push:s.target.checked})}),"Send Push Notification"]}),e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"6px",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:t.send_sms,onChange:s=>r({...t,send_sms:s.target.checked})}),"Send SMS (Costs apply)"]})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"2rem"},children:[e.jsx("button",{type:"submit",className:"btn btn-primary",style:{flex:1},children:"Save as Draft"}),e.jsx("button",{type:"button",className:"btn btn-outline",onClick:()=>a(!1),children:"Cancel"})]})]})]})}),e.jsx("div",{className:"admin-content",children:j?e.jsx("p",{children:"Loading announcements..."}):u.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"3rem",color:"#94a3b8"},children:[e.jsx(x,{size:48,style:{marginBottom:"1rem"}}),e.jsx("p",{children:"No announcements yet. Create your first one!"})]}):e.jsx("div",{className:"admin-list",children:u.map(s=>e.jsx("div",{className:"admin-list-item",style:{background:"white",padding:"1.5rem",borderRadius:"12px",marginBottom:"1rem",border:`2px solid ${s.status==="published"?"#22c55e":"#e5e7eb"}`},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"1rem"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"0.5rem"},children:[e.jsx("h3",{style:{margin:0},children:s.title}),S(s.status),e.jsx("span",{style:{padding:"2px 8px",borderRadius:"4px",background:`${h(s.priority)}20`,color:h(s.priority),fontSize:"0.7rem",fontWeight:600,textTransform:"uppercase"},children:s.priority})]}),e.jsxs("p",{style:{color:"#64748b",margin:"0.5rem 0",lineHeight:1.5},children:[s.content.substring(0,150),"..."]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",fontSize:"0.8rem",color:"#94a3b8",marginTop:"0.75rem"},children:[e.jsxs("span",{children:[e.jsx(w,{size:14,style:{verticalAlign:"middle",marginRight:"4px"}}),s.target_audience]}),e.jsxs("span",{children:[e.jsx(A,{size:14,style:{verticalAlign:"middle",marginRight:"4px"}}),T(new Date(s.created_at),"MMM dd, yyyy")]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[s.status==="draft"&&e.jsxs("button",{className:"btn btn-primary btn-sm",onClick:()=>C(s.id),title:"Publish Now",children:[e.jsx(P,{size:16})," Publish"]}),e.jsx("button",{className:"btn btn-icon",onClick:()=>{m(s.id),r(s),a(!0)},children:e.jsx(g,{size:18})}),e.jsx("button",{className:"btn btn-icon delete",onClick:()=>_(s.id),children:e.jsx(z,{size:18})})]})]})},s.id))})})]})};export{L as default};
