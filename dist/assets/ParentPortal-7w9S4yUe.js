import{H as W,r as s,s as d,j as e,F as p,B as I,g as M,C as L,J as q,M as F,L as P,X as _}from"./index-BwtYp3Ig.js";import{p as x}from"./parentAuth-ExENRmBl.js";import{R as E}from"./ReportCard-DUJvGfHx.js";import{P as A}from"./PortalFAB-CjVw2ynL.js";import{L as D}from"./log-out-Beoi4E0B.js";import{U as Y}from"./user-D7GJY-MG.js";import{C as H}from"./credit-card-DVvh52CU.js";import"./award-COrM1c8p.js";import"./activity-Ms-EpHjB.js";import"./check-circle-2-BrO1oXUG.js";import"./download-Bw_uiH9L.js";const ee=()=>{const a=W(),[i,h]=s.useState([]),[m,b]=s.useState(0),[g,c]=s.useState(null),[y,j]=s.useState([]),[v,k]=s.useState({}),[w,C]=s.useState([]),[S,f]=s.useState(!1);s.useEffect(()=>{if(!x.isAuthenticated()){a("/parents");return}T()},[a]);const T=async()=>{const t=sessionStorage.getItem("parentPhone");if(!t){console.error("No parent phone found in session");return}const{data:r}=await d.from("students").select("*").eq("parent_phone",t);if(h(r||[]),r&&r.length>0){const l=r.map(o=>o.id),{data:n}=await d.from("notifications").select("id").in("student_id",l).eq("is_read",!1);b((n==null?void 0:n.length)||0)}},z=()=>{x.logout(),sessionStorage.removeItem("parentPhone"),a("/parents")},u=async t=>{c(t),f(!0);try{const r=new Date().getFullYear(),{data:l,error:n}=await d.from("grades").select("*, subjects(name, category)").eq("student_id",t.id).eq("year",r).order("created_at",{ascending:!1});if(n)throw n;j(l||[]);const{data:o}=await d.from("report_metadata").select("*").eq("student_id",t.id).eq("term","Term 1").eq("year",r).single();k(o||{});const{data:B}=await d.from("competencies").select("*").eq("student_id",t.id).eq("term","Term 1").eq("year",r);C(B||[])}catch(r){console.error("Error fetching report:",r),alert("Failed to load report card.")}finally{f(!1)}},R=[{icon:I,title:"Notifications",description:"View all alerts and updates",link:"/parent/notifications",color:"#f59e0b",badge:m>0?m:null},{icon:p,title:"Announcements",description:"School news and important info",link:"/parent/announcements",color:"#06b6d4"},{icon:M,title:"Leave Request",description:"Submit absence requests",link:"/parent/leave-request",color:"#8b5cf6"},{icon:L,title:"Events Calendar",description:"Upcoming school events",link:"/calendar",color:"#22c55e"},{icon:q,title:"Academic Resources",description:"Study materials and past papers",link:"/resources",color:"#3b82f6"},{icon:H,title:"Fee Payment",description:"Check balance and pay fees online",link:"/parent/fees",color:"#f97316"},{icon:F,title:"Contact School",description:"Get in touch with us",link:"/contact",color:"#ef4444"}];return e.jsxs("div",{style:{minHeight:"100vh",backgroundImage:'url("/images/parent-portal-bg.png")',backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed",paddingBottom:"4rem"},children:[e.jsxs("div",{style:{minHeight:"100vh",background:"rgba(241, 245, 249, 0.85)",backdropFilter:"blur(12px)",maxWidth:"1200px",margin:"0 auto",padding:"clamp(1.5rem, 4vw, 2.5rem) clamp(1rem, 4vw, 2rem)",boxShadow:"0 0 40px rgba(0,0,0,0.05)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"clamp(2rem, 5vw, 3rem)",flexWrap:"wrap",gap:"1rem"},children:[e.jsxs("div",{children:[e.jsx("h1",{style:{fontFamily:"'Barlow Condensed', sans-serif",fontSize:"clamp(2.5rem, 6vw, 3.5rem)",fontWeight:900,textTransform:"uppercase",background:"linear-gradient(135deg, #dc2626, #991b1b)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",marginBottom:"0.25rem"},children:"Parent Portal"}),e.jsx("p",{style:{color:"#64748b",fontSize:"clamp(0.95rem, 2.5vw, 1.05rem)",fontWeight:500},children:"Welcome back! Manage your child's school journey."})]}),e.jsxs("button",{onClick:z,style:{padding:"0.75rem 1.5rem",background:"white",border:"1px solid #e2e8f0",borderRadius:"12px",color:"#64748b",fontSize:"0.9rem",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",transition:"all 0.2s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},onMouseEnter:t=>{t.target.style.borderColor="#dc2626",t.target.style.color="#dc2626"},onMouseLeave:t=>{t.target.style.borderColor="#e2e8f0",t.target.style.color="#64748b"},children:[e.jsx(D,{size:18}),"Logout"]})]}),i.length>0&&e.jsxs("div",{style:{marginBottom:"clamp(3rem, 6vw, 4rem)"},children:[e.jsx("h2",{style:{fontFamily:"'Barlow Condensed', sans-serif",fontSize:"1.8rem",fontWeight:800,textTransform:"uppercase",marginBottom:"1.5rem",color:"#1e293b"},children:"Your Children"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(min(320px, 100%), 1fr))",gap:"2rem"},children:i.map(t=>e.jsxs("div",{style:{background:"white",padding:"2rem",borderRadius:"24px",border:"1px solid #e2e8f0",transition:"all 0.3s",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.05)"},onMouseEnter:r=>{r.currentTarget.style.borderColor="#dc2626",r.currentTarget.style.boxShadow="0 20px 40px rgba(0, 0, 0, 0.05)"},onMouseLeave:r=>{r.currentTarget.style.borderColor="#e2e8f0",r.currentTarget.style.boxShadow="0 4px 6px -1px rgba(0, 0, 0, 0.05)"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1.25rem",marginBottom:"1.5rem"},children:[e.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"16px",background:"#f8fafc",display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #f1f5f9"},children:e.jsx(Y,{size:28,color:"#dc2626"})}),e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:"1.2rem",color:"#0f172a",fontWeight:700},children:t.student_name}),e.jsx("p",{style:{margin:"2px 0 0",color:"#64748b",fontSize:"0.9rem",fontWeight:500},children:t.student_reg_number})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem",fontSize:"0.9rem",padding:"1.25rem",background:"#f8fafc",borderRadius:"16px",marginBottom:"1.5rem"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{color:"#94a3b8",display:"block",fontSize:"0.75rem",fontWeight:700,textTransform:"uppercase",marginBottom:"2px"},children:"Class"}),e.jsx("strong",{style:{color:"#0f172a"},children:t.class_grade})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"#94a3b8",display:"block",fontSize:"0.75rem",fontWeight:700,textTransform:"uppercase",marginBottom:"2px"},children:"House"}),e.jsx("strong",{style:{color:"#0f172a"},children:t.house})]})]}),e.jsxs("button",{onClick:()=>u(t),style:{width:"100%",padding:"1rem",borderRadius:"12px",border:"none",background:"#0f172a",color:"white",fontWeight:700,fontSize:"0.9rem",textTransform:"uppercase",letterSpacing:"0.05em",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",transition:"all 0.2s"},onMouseEnter:r=>{r.target.style.background="#dc2626"},onMouseLeave:r=>{r.target.style.background="#0f172a"},children:[e.jsx(p,{size:18}),"View Report"]})]},t.id))})]}),e.jsxs("div",{children:[e.jsx("h2",{style:{fontFamily:"'Barlow Condensed', sans-serif",fontSize:"1.8rem",fontWeight:800,textTransform:"uppercase",marginBottom:"1.5rem",color:"#1e293b"},children:"Quick Actions"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(min(280px, 100%), 1fr))",gap:"1.5rem"},children:R.map((t,r)=>{const l=t.icon,n=t.color==="#f59e0b"||t.color==="#f97316"?"#dc2626":t.color;return e.jsxs(P,{to:t.link,style:{background:"white",padding:"1.5rem",borderRadius:"20px",border:"1px solid #e2e8f0",textDecoration:"none",transition:"all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)",position:"relative",display:"block"},onMouseEnter:o=>{o.currentTarget.style.transform="translateY(-6px)",o.currentTarget.style.borderColor=n,o.currentTarget.style.boxShadow=`0 12px 24px ${n}15`},onMouseLeave:o=>{o.currentTarget.style.transform="translateY(0)",o.currentTarget.style.borderColor="#e2e8f0",o.currentTarget.style.boxShadow="none"},children:[t.badge&&e.jsx("div",{style:{position:"absolute",top:"12px",right:"12px",background:"#dc2626",color:"white",width:"22px",height:"22px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.7rem",fontWeight:900},children:t.badge}),e.jsx("div",{style:{width:"48px",height:"48px",background:"#f8fafc",borderRadius:"12px",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:"1rem",border:"1px solid #f1f5f9"},children:e.jsx(l,{size:22,color:n})}),e.jsx("h3",{style:{fontFamily:"'Barlow Condensed', sans-serif",margin:"0 0 0.5rem",fontSize:"1.3rem",color:"#0f172a",fontWeight:700,textTransform:"uppercase"},children:t.title}),e.jsx("p",{style:{margin:0,color:"#64748b",fontSize:"0.9rem",lineHeight:1.5,fontWeight:500},children:t.description})]},r)})})]}),g&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.7)",backdropFilter:"blur(4px)",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center",padding:"1.5rem"},onClick:()=>c(null),children:e.jsxs("div",{style:{background:"white",width:"100%",maxWidth:"900px",maxHeight:"90vh",borderRadius:"16px",overflow:"hidden",display:"flex",flexDirection:"column",position:"relative"},onClick:t=>t.stopPropagation(),children:[e.jsxs("div",{style:{padding:"1.25rem 2rem",borderBottom:"1px solid #e2e8f0",display:"flex",justifyContent:"space-between",alignItems:"center",background:"#f8fafc"},children:[e.jsxs("div",{children:[e.jsx("h2",{style:{fontFamily:"'Barlow Condensed', sans-serif",margin:0,fontSize:"1.5rem",fontWeight:800,color:"#0f172a",textTransform:"uppercase"},children:"Academic Report Card"}),e.jsx("p",{style:{margin:0,color:"#64748b",fontSize:"0.9rem",fontWeight:500},children:"Previewing student results"})]}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem"},children:[e.jsxs("button",{onClick:()=>window.print(),style:{padding:"0.6rem 1.25rem",borderRadius:"8px",border:"1px solid #e2e8f0",background:"white",color:"#0f172a",fontSize:"0.85rem",fontWeight:700,cursor:"pointer",display:"flex",alignItems:"center",gap:"0.5rem",transition:"all 0.2s",textTransform:"uppercase",letterSpacing:"0.05em"},onMouseEnter:t=>{t.target.style.background="#f1f5f9"},onMouseLeave:t=>{t.target.style.background="white"},children:[e.jsx(p,{size:16}),"Print"]}),e.jsx("button",{onClick:()=>c(null),style:{padding:"0.6rem",borderRadius:"8px",border:"1px solid #fee2e2",background:"#fef2f2",color:"#dc2626",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s"},onMouseEnter:t=>{t.target.style.background="#fee2e2"},onMouseLeave:t=>{t.target.style.background="#fef2f2"},children:e.jsx(_,{size:20})})]})]}),e.jsx("div",{style:{padding:"2rem",overflowY:"auto",flex:1},children:S?e.jsx("div",{style:{textAlign:"center",padding:"3rem",color:"#6b7280"},children:"Loading report card..."}):e.jsx(E,{student:g,grades:y,metadata:v,competencies:w,term:"Term 1",year:new Date().getFullYear()})})]})})]}),e.jsx("style",{children:`
                @media print {
                    body * {
                        visibility: hidden;
                    }
                    .report-card-container, .report-card-container * {
                        visibility: visible;
                    }
                    .report-card-container {
                        position: absolute;
                        left: 0;
                        top: 0;
                        width: 100%;
                    }
                }
            `}),e.jsx(A,{role:"parent",onAction:t=>{t==="report"&&i.length>0&&u(i[0]),t==="fees"&&a("/parent/fees"),t==="idcard"&&i.length>0&&a("/student-portal")}})]})};export{ee as default};
