import{d as S,H as E,r as l,s as o,j as e}from"./index-DnZapYtk.js";import{c as k}from"./cache-BThuL7vy.js";import{A as D}from"./arrow-left-CX5MFHt8.js";import{U as I}from"./upload-BXbAIg_5.js";import{S as U}from"./save-BWmYaoU4.js";const z=()=>{const{id:d}=S(),h=E(),n=!!d,[t,g]=l.useState({title:"",slug:"",excerpt:"",content:"",image_url:"",published_at:new Date().toISOString().split("T")[0],is_published:!1}),[x,c]=l.useState(!1),[f,j]=l.useState(!1),[y,b]=l.useState(null);l.useEffect(()=>{n&&w()},[d]);const w=async()=>{try{c(!0);const{data:r,error:s}=await o.from("news").select("*").eq("id",d).single();if(s)throw s;const a={...r,published_at:r.published_at?new Date(r.published_at).toISOString().split("T")[0]:""};g(a)}catch(r){console.error("Error fetching news:",r),b("Could not load news item.")}finally{c(!1)}},i=r=>{const{name:s,value:a,type:v,checked:m}=r.target;g(u=>{const p={...u,[s]:v==="checkbox"?m:a};return s==="title"&&!n&&(p.slug=a.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,"")),p})},N=async r=>{try{j(!0);const s=r.target.files[0];if(!s)return;const a=s.name.split(".").pop(),m=`${`${Math.random()}.${a}`}`,{error:u}=await o.storage.from("images").upload(m,s);if(u)throw u;const{data:p}=o.storage.from("images").getPublicUrl(m);g(C=>({...C,image_url:p.publicUrl}))}catch(s){console.error("Error uploading image:",s),alert('Error uploading image. Make sure the "images" bucket exists and is public.')}finally{j(!1)}},_=async r=>{r.preventDefault(),c(!0),b(null);try{const s={title:t.title,slug:t.slug,excerpt:t.excerpt,content:t.content,image_url:t.image_url,published_at:t.published_at,is_published:t.is_published};if(n){const{error:a}=await o.from("news").update(s).eq("id",d);if(a)throw a}else{const{error:a}=await o.from("news").insert([s]);if(a)throw a}k.invalidate("home_data"),h("/admin/news")}catch(s){console.error("Error saving news:",s),b(s.message)}finally{c(!1)}};return x&&n&&!t.title?e.jsx("div",{style:{padding:"2rem"},children:"Loading..."}):e.jsxs("div",{className:"admin-page admin-fade-in",children:[e.jsx("div",{className:"admin-header",children:e.jsxs("div",{children:[e.jsx("button",{onClick:()=>h("/admin/news"),className:"btn btn-icon",style:{marginBottom:"1rem",color:"#64748b"},children:e.jsx(D,{size:20})}),e.jsx("h1",{children:n?"Edit News":"Create News"})]})}),e.jsxs("div",{className:"admin-form-container",children:[y&&e.jsx("div",{style:{background:"#fee2e2",color:"#991b1b",padding:"1rem",borderRadius:"6px",marginBottom:"1.5rem"},children:y}),e.jsxs("form",{onSubmit:_,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Title"}),e.jsx("input",{type:"text",name:"title",value:t.title,onChange:i,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Slug (URL)"}),e.jsx("input",{type:"text",name:"slug",value:t.slug,onChange:i,required:!0,style:{backgroundColor:"#f9fafb"}})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Excerpt (Short Summary)"}),e.jsx("textarea",{name:"excerpt",value:t.excerpt,onChange:i,rows:3})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Content"}),e.jsx("textarea",{name:"content",value:t.content,onChange:i,required:!0,rows:10})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Featured Image"}),e.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center",flexWrap:"wrap"},children:[e.jsx("input",{type:"text",name:"image_url",value:t.image_url,onChange:i,placeholder:"https://...",style:{flex:"1",minWidth:"200px"}}),e.jsxs("div",{style:{position:"relative"},children:[e.jsx("input",{type:"file",accept:"image/*",onChange:N,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",opacity:0,cursor:"pointer"},disabled:f}),e.jsx("button",{type:"button",className:"btn btn-outline",disabled:f,children:f?"Uploading...":e.jsxs(e.Fragment,{children:[e.jsx(I,{size:16})," Upload"]})})]})]}),t.image_url&&e.jsx("div",{style:{marginTop:"1rem",width:"200px",height:"120px",overflow:"hidden",borderRadius:"12px",border:"1px solid #e5e7eb"},children:e.jsx("img",{src:t.image_url,alt:"Preview",style:{width:"100%",height:"100%",objectFit:"cover"}})})]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Publish Date"}),e.jsx("input",{type:"date",name:"published_at",value:t.published_at,onChange:i})]}),e.jsx("div",{className:"form-group",style:{display:"flex",alignItems:"center",paddingTop:"1.8rem"},children:e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.8rem",cursor:"pointer",fontWeight:"500"},children:[e.jsx("input",{type:"checkbox",name:"is_published",checked:t.is_published,onChange:i,style:{width:"1.25rem",height:"1.25rem",padding:0}}),e.jsx("span",{children:"Publish Immediately"})]})})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"1rem",marginTop:"2rem"},children:[e.jsx("button",{type:"button",onClick:()=>h("/admin/news"),className:"btn btn-outline",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:x,children:x?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(U,{size:18})," Save News"]})})]})]})]})]})};export{z as default};
