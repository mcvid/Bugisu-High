import{r as s,s as n,j as e,a5 as C,X as I}from"./index-BwtYp3Ig.js";import{c as b}from"./cache-BThuL7vy.js";import{P as y}from"./pencil-DSj-Luxt.js";import{U as j}from"./upload-DHc5piML.js";import{S as R}from"./save-BnUOIqxV.js";import{T as U}from"./trash-2-CNEj7xb6.js";const q=()=>{const[m,p]=s.useState([]),[v,g]=s.useState(!0),[d,f]=s.useState(!1),[a,c]=s.useState(null),[i,l]=s.useState({name:"",role:"",image_url:""});s.useEffect(()=>{x()},[]);const x=async()=>{g(!0);const{data:r,error:t}=await n.from("administration").select("*").order("sort_order",{ascending:!0}).order("created_at",{ascending:!0});r&&p(r),g(!1)},w=async r=>{const t=r.target.files[0];if(t){f(!0);try{const o=t.name.split(".").pop(),h=`administration/${`${Math.random()}.${o}`}`,{error:u}=await n.storage.from("images").upload(h,t);if(u)throw u;const{data:{publicUrl:E}}=n.storage.from("images").getPublicUrl(h);l({...i,image_url:E})}catch(o){console.error("Error uploading image:",o),alert("Upload failed!")}finally{f(!1)}}},S=async r=>{if(r.preventDefault(),!(!i.name||!i.role))try{if(a){const{error:t}=await n.from("administration").update({name:i.name,role:i.role,image_url:i.image_url}).eq("id",a);if(t)throw t}else{const{error:t}=await n.from("administration").insert([i]);if(t)throw t}l({name:"",role:"",image_url:""}),c(null),x(),b.invalidate("home_data")}catch(t){console.error("Error saving staff member:",t),alert("Save failed!")}},z=r=>{c(r.id),l({name:r.name,role:r.role,image_url:r.image_url}),window.scrollTo({top:0,behavior:"smooth"})},_=async r=>{if(window.confirm("Are you sure you want to delete this staff member?"))try{const{error:t}=await n.from("administration").delete().eq("id",r);if(t)throw t;p(m.filter(o=>o.id!==r)),b.invalidate("home_data")}catch(t){console.error("Delete failed:",t),alert("Delete failed!")}},k=()=>{c(null),l({name:"",role:"",image_url:""})};return e.jsxs("div",{className:"admin-page",children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rem"},children:e.jsxs("div",{children:[e.jsx("h1",{children:"Administration Management"}),e.jsx("p",{style:{color:"#6b7280"},children:"Add, edit, or remove school leadership members."})]})}),e.jsxs("div",{style:{background:"white",padding:"2rem",borderRadius:"12px",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.1)",marginBottom:"3rem"},children:[e.jsxs("h3",{style:{fontSize:"1.25rem",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[a?e.jsx(y,{size:20}):e.jsx(C,{size:20}),a?"Edit Staff Member":"Add New Staff Member"]}),e.jsxs("form",{onSubmit:S,style:{display:"grid",gap:"1.5rem"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1.5rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500"},children:"Full Name"}),e.jsx("input",{type:"text",placeholder:"e.g. Mr. John Okello",value:i.name,onChange:r=>l({...i,name:r.target.value}),style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"8px"},required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500"},children:"Role / Position"}),e.jsx("input",{type:"text",placeholder:"e.g. Head Teacher",value:i.role,onChange:r=>l({...i,role:r.target.value}),style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"8px"},required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500"},children:"Photo"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1.5rem"},children:[e.jsx("div",{style:{width:"80px",height:"80px",borderRadius:"50%",background:"#f3f4f6",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",border:"2px solid #e5e7eb"},children:i.image_url?e.jsx("img",{src:i.image_url,alt:"Preview",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx(j,{size:24,color:"#9ca3af"})}),e.jsxs("div",{children:[e.jsxs("label",{className:"btn btn-outline",style:{cursor:d?"wait":"pointer",display:"inline-flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(j,{size:16}),d?"Uploading...":"Upload Image",e.jsx("input",{type:"file",onChange:w,style:{display:"none"},accept:"image/*",disabled:d})]}),e.jsx("p",{style:{fontSize:"0.75rem",color:"#6b7280",marginTop:"0.5rem"},children:"Recommended: Square image, 400x400px"})]})]})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("button",{type:"submit",className:"btn btn-primary",style:{display:"inline-flex",alignItems:"center",gap:"0.5rem"},disabled:d,children:[e.jsx(R,{size:18}),a?"Update Member":"Add Member"]}),a&&e.jsxs("button",{type:"button",onClick:k,className:"btn btn-outline",style:{display:"inline-flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(I,{size:18})," Cancel"]})]})]})]}),e.jsx("h2",{style:{fontSize:"1.5rem",marginBottom:"1.5rem"},children:"Current Administration"}),v?e.jsx("p",{children:"Loading staff list..."}):m.length===0?e.jsx("div",{style:{textAlign:"center",padding:"3rem",background:"#f9fafb",borderRadius:"12px",border:"2px dashed #e5e7eb"},children:e.jsx("p",{style:{color:"#6b7280"},children:"No administration members added yet."})}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"1.5rem"},children:m.map(r=>e.jsx("div",{style:{background:"white",borderRadius:"12px",overflow:"hidden",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #f3f4f6",transition:"transform 0.2s",position:"relative"},children:e.jsxs("div",{style:{display:"flex",padding:"1rem",alignItems:"center",gap:"1rem"},children:[e.jsx("img",{src:r.image_url||"https://via.placeholder.com/150",alt:r.name,style:{width:"60px",height:"60px",borderRadius:"50%",objectFit:"cover"}}),e.jsxs("div",{style:{flex:1},children:[e.jsx("h4",{style:{margin:0,fontSize:"1rem"},children:r.name}),e.jsx("p",{style:{margin:0,fontSize:"0.875rem",color:"#6b7280"},children:r.role})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>z(r),style:{background:"none",border:"none",cursor:"pointer",color:"var(--color-primary)",padding:"4px"},title:"Edit",children:e.jsx(y,{size:18})}),e.jsx("button",{onClick:()=>_(r.id),style:{background:"none",border:"none",cursor:"pointer",color:"#ef4444",padding:"4px"},title:"Delete",children:e.jsx(U,{size:18})})]})]})},r.id))})]})};export{q as default};
