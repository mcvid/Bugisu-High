import{c as k,r,j as t,u as b,s as y,X as N}from"./index-EH-KDdP-.js";import{M as g,R as _}from"./index-iAFrcoye.js";import{S}from"./SEO-DtVSemPV.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=k("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]),P=({imageUrl:l,initialYaw:u=0,initialPitch:x=0,hotspots:e=[],onHotspotClick:o,onReady:h})=>{const f=r.useRef(null),[n,c]=r.useState(null),m=i=>{f.current=i,c(i);const a=i.getPlugin(g);a&&a.addEventListener("select-marker",({marker:p})=>{o&&p.data&&o(p.data)}),h&&h(i)};return r.useEffect(()=>{if(n&&e){const i=n.getPlugin(g);i&&(i.clearMarkers(),e.forEach(a=>{i.addMarker({id:a.id,position:{yaw:a.yaw,pitch:a.pitch},image:"https://photo-sphere-viewer.js.org/assets/pin-red.png",size:{width:32,height:32},tooltip:a.label,anchor:"bottom center",data:a})}))}},[n,e]),l?t.jsx("div",{className:"tour-viewer-container",style:{width:"100%",height:"100%"},children:t.jsx(_,{src:l,height:"100%",width:"100%",defaultYaw:u,defaultPitch:x,container:"",onReady:m,plugins:[[g,{}]],navbar:["zoom","move","caption","fullscreen"]})}):t.jsx("div",{className:"tour-loading",children:"Loading tour..."})},R=()=>{const{t:l}=b(["tour","common"]),[u,x]=r.useState([]),[e,o]=r.useState(null),[h,f]=r.useState([]),[n,c]=r.useState(!0),[m,i]=r.useState(!0);r.useEffect(()=>{a()},[]),r.useEffect(()=>{e&&p(e.id)},[e]);const a=async()=>{i(!0);const{data:s}=await y.from("tour_stops").select("*").order("created_at");s&&s.length>0&&(x(s),e||o(s[0])),i(!1)},p=async s=>{const{data:d}=await y.from("tour_hotspots").select("*").eq("stop_id",s);d&&f(d)},j=s=>{o(s),window.innerWidth<768&&c(!1)},v=s=>{if(s.target_stop_id){const d=u.find(w=>w.id===s.target_stop_id);d&&j(d)}};return t.jsxs("div",{className:"virtual-tour-page",children:[t.jsx(S,{title:e?`Virtual Tour: ${e.title}`:"Virtual Campus Tour",description:(e==null?void 0:e.description)||"Take a 360-degree virtual tour of Bugisu High School campus and facilities.",image:e==null?void 0:e.image_url,url:"/virtual-tour"}),t.jsxs("div",{className:`tour-sidebar ${n?"open":"closed"}`,children:[t.jsxs("div",{className:"tour-header",children:[t.jsx("h2",{children:l("sidebar_title")}),t.jsx("button",{className:"close-tour-sidebar",onClick:()=>c(!1),children:t.jsx(N,{size:20})})]}),t.jsx("div",{className:"tour-stops-list",children:m?t.jsx("p",{className:"p-4",children:l("common.loading")}):u.map(s=>t.jsxs("div",{className:`tour-stop-item ${(e==null?void 0:e.id)===s.id?"active":""}`,onClick:()=>j(s),children:[t.jsx("img",{src:s.thumbnail_url||s.image_url,alt:s.title}),t.jsx("div",{className:"stop-info",children:t.jsx("h4",{children:s.title})})]},s.id))})]}),t.jsxs("div",{className:"tour-main",children:[t.jsx("button",{className:"toggle-tour-sidebar",onClick:()=>c(!n),children:t.jsx(E,{size:24})}),e?t.jsxs("div",{className:"viewer-wrapper",children:[t.jsx(P,{imageUrl:e.image_url,initialYaw:e.initial_yaw,initialPitch:e.initial_pitch,hotspots:h,onHotspotClick:v},e.id),t.jsxs("div",{className:"current-stop-overlay",children:[t.jsx("h3",{children:e.title}),e.description&&t.jsx("p",{children:e.description})]})]}):t.jsx("div",{className:"tour-empty-state",children:t.jsx("p",{children:l(m?"loading":"empty")})})]})]})};export{R as default};
