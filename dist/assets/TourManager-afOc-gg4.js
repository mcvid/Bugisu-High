import{c as F,r as a,j as e,s as p,a5 as H,a7 as P}from"./index-DqW8wV2_.js";import{c as z}from"./cache-BThuL7vy.js";import{M as D,R}from"./index-td2aZf9o.js";import{M as q}from"./map-mmVIqrku.js";import{M as A}from"./map-pin-CZ02tHVB.js";import{P as U}from"./pen-square-CvPFNc_S.js";import{T as I}from"./trash-2-C5gPLAv6.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L=F("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]),W=()=>{const[n,u]=a.useState("stops");return e.jsxs("div",{className:"admin-page",children:[e.jsxs("div",{className:"admin-header",children:[e.jsx("h1",{children:"Virtual Tour Manager"}),e.jsx("p",{children:"Manage campus tour locations, panoramic images, and interactive hotspots."})]}),e.jsxs("div",{className:"admin-tabs",children:[e.jsxs("button",{className:`tab-btn ${n==="stops"?"active":""}`,onClick:()=>u("stops"),children:[e.jsx(q,{size:18})," Tour Stops"]}),e.jsxs("button",{className:`tab-btn ${n==="hotspots"?"active":""}`,onClick:()=>u("hotspots"),children:[e.jsx(A,{size:18})," Hotspots Editor"]})]}),e.jsxs("div",{className:"admin-content-wrapper",children:[n==="stops"&&e.jsx(B,{}),n==="hotspots"&&e.jsx(V,{})]})]})},B=()=>{const[n,u]=a.useState([]),[o,x]=a.useState(!1),[c,g]=a.useState(null),[m,v]=a.useState(!1),[j,f]=a.useState(!0),[l,d]=a.useState({title:"",description:"",image_url:"",thumbnail_url:"",initial_yaw:0,initial_pitch:0});a.useEffect(()=>{h()},[]);const h=async()=>{f(!0);const{data:s}=await p.from("tour_stops").select("*").order("created_at");s&&u(s),f(!1)},b=async s=>{try{v(!0);const r=s.target.files[0];if(!r)return;const T=r.name.split(".").pop(),S=`stops/${`${Math.random()}.${T}`}`,{error:_}=await p.storage.from("campus_tours").upload(S,r);if(_)throw _;const{data:N}=p.storage.from("campus_tours").getPublicUrl(S);d(E=>({...E,image_url:N.publicUrl,thumbnail_url:N.publicUrl}))}catch(r){console.error("Error uploading image:",r),alert("Error uploading image")}finally{v(!1)}},k=async s=>{s.preventDefault();try{c?await p.from("tour_stops").update(l).eq("id",c.id):await p.from("tour_stops").insert([l]),x(!1),g(null),d({title:"",description:"",image_url:"",thumbnail_url:"",initial_yaw:0,initial_pitch:0}),h(),z.invalidate("home_data")}catch(r){console.error("Error saving stop:",r),alert("Failed to save stop")}},y=async s=>{window.confirm("Delete this tour stop?")&&(await p.from("tour_stops").delete().eq("id",s),h(),z.invalidate("home_data"))};return e.jsxs("div",{className:"tab-content",children:[e.jsxs("div",{className:"flex-between",style:{marginBottom:"1rem"},children:[e.jsx("h3",{children:"Tour Locations"}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>{g(null),d({title:"",description:"",image_url:"",thumbnail_url:"",initial_yaw:0,initial_pitch:0}),x(!0)},children:[e.jsx(H,{size:16})," Add Stop"]})]}),o&&e.jsxs("div",{className:"admin-card form-card",children:[e.jsx("h4",{children:c?"Edit Stop":"Add New Stop"}),e.jsxs("form",{onSubmit:k,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Location Title"}),e.jsx("input",{value:l.title,onChange:s=>d({...l,title:s.target.value}),placeholder:"e.g. Main Gate",required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"360Â°/Panorama Image"}),e.jsxs("div",{className:"file-upload-wrapper",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:b,disabled:m}),m&&e.jsx("span",{children:"Uploading..."})]}),l.image_url&&e.jsx("div",{style:{marginTop:"0.5rem"},children:e.jsx("img",{src:l.image_url,alt:"Preview",style:{height:"100px",objectFit:"cover",borderRadius:"4px"}})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:l.description,onChange:s=>d({...l,description:s.target.value}),rows:3})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn btn-outline",onClick:()=>x(!1),children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:m,children:"Save Stop"})]})]})]}),e.jsx("div",{className:"grid-list",children:n.map(s=>{var r;return e.jsxs("div",{className:"admin-card list-item",children:[e.jsxs("div",{style:{display:"flex",gap:"1rem",alignItems:"center"},children:[e.jsx("img",{src:s.thumbnail_url||s.image_url,alt:s.title,style:{width:"80px",height:"60px",objectFit:"cover",borderRadius:"4px",backgroundColor:"#eee"}}),e.jsxs("div",{children:[e.jsx("h4",{children:s.title}),e.jsxs("p",{style:{fontSize:"0.9rem",color:"#666"},children:[(r=s.description)==null?void 0:r.substring(0,60),"..."]})]})]}),e.jsxs("div",{className:"actions",children:[e.jsx("button",{className:"btn btn-sm btn-outline",onClick:()=>{g(s),d(s),x(!0)},children:e.jsx(U,{size:14})}),e.jsx("button",{className:"btn-icon delete",onClick:()=>y(s.id),children:e.jsx(I,{size:16})})]})]},s.id)})})]})},V=()=>{const[n,u]=a.useState([]),[o,x]=a.useState(""),[c,g]=a.useState([]),[m,v]=a.useState(null),[j,f]=a.useState(!1),[l,d]=a.useState(!1),[h,b]=a.useState(null),[k,y]=a.useState(!1),[s,r]=a.useState({label:"",target_stop_id:"",type:"scene"});a.useEffect(()=>{T()},[]),a.useEffect(()=>{o?w(o):g([])},[o]),a.useEffect(()=>{if(m&&c.length>=0){const t=m.getPlugin(D);t&&(t.clearMarkers(),c.forEach(i=>{t.addMarker({id:i.id,position:{yaw:i.yaw,pitch:i.pitch},image:"https://photo-sphere-viewer.js.org/assets/pin-red.png",size:{width:32,height:32},tooltip:i.label,anchor:"bottom center"})}))}},[m,c]);const T=async()=>{const{data:t}=await p.from("tour_stops").select("*").order("title");t&&u(t)},w=async t=>{const{data:i}=await p.from("tour_hotspots").select("*").eq("stop_id",t);i&&g(i)},S=t=>{v(t)},_=t=>{j&&(b({yaw:t.yaw,pitch:t.pitch}),d(!0),f(!1))},N=async t=>{if(t.preventDefault(),!(!h||!o))try{y(!0);const i={stop_id:o,...s,pitch:h.pitch,yaw:h.yaw},{error:C}=await p.from("tour_hotspots").insert([i]);if(C)throw C;w(o),d(!1),r({label:"",target_stop_id:"",type:"scene"}),b(null),alert("Hotspot added!")}catch(i){console.error("Error saving hotspot:",i),alert("Failed to save hotspot")}finally{y(!1)}},E=async t=>{window.confirm("Delete this hotspot?")&&(await p.from("tour_hotspots").delete().eq("id",t),w(o))},M=n.find(t=>t.id===o);return e.jsxs("div",{className:"tab-content",style:{display:"flex",gap:"1rem",height:"calc(100vh - 200px)"},children:[e.jsxs("div",{style:{width:"300px",display:"flex",flexDirection:"column",gap:"1rem",overflowY:"auto"},children:[e.jsxs("div",{className:"admin-card",children:[e.jsx("h4",{children:"1. Select Scene"}),e.jsxs("select",{style:{width:"100%",padding:"0.5rem"},value:o,onChange:t=>x(t.target.value),children:[e.jsx("option",{value:"",children:"-- Choose a location --"}),n.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),M&&e.jsxs("div",{className:"admin-card",children:[e.jsx("h4",{children:"2. Manage Hotspots"}),e.jsx("p",{style:{fontSize:"0.9rem",color:"#666",marginBottom:"1rem"},children:j?"Click anywhere on the image to place the hotspot.":"Click 'Add Hotspot' then click on the panorama."}),!j&&!l&&e.jsxs("button",{className:"btn btn-primary w-full",onClick:()=>f(!0),style:{marginBottom:"1rem"},children:[e.jsx(H,{size:16})," Add Hotspot"]}),j&&e.jsxs("div",{className:"alert alert-info",style:{padding:"0.5rem",fontSize:"0.9rem"},children:[e.jsx(L,{size:14})," Tap on image to place...",e.jsx("button",{onClick:()=>f(!1),style:{marginLeft:"0.5rem",textDecoration:"underline",background:"none",border:"none",color:"inherit",cursor:"pointer"},children:"Cancel"})]}),e.jsxs("div",{className:"hotspots-list",style:{marginTop:"1rem"},children:[e.jsxs("h5",{style:{marginBottom:"0.5rem"},children:["Existing Hotspots (",c.length,")"]}),c.length===0&&e.jsx("p",{className:"text-grey text-sm",children:"No hotspots yet."}),c.map(t=>{const i=n.find(C=>C.id===t.target_stop_id);return e.jsxs("div",{style:{background:"#f9fafb",padding:"0.5rem",borderRadius:"4px",marginBottom:"0.5rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:t.label}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"#666"},children:["Target: ",(i==null?void 0:i.title)||"Unknown"]})]}),e.jsx("button",{className:"btn-icon delete",onClick:()=>E(t.id),children:e.jsx(I,{size:14})})]},t.id)})]})]})]}),e.jsx("div",{style:{flex:1,position:"relative",borderRadius:"8px",overflow:"hidden",backgroundColor:"#000"},children:M?e.jsxs(e.Fragment,{children:[e.jsx(R,{src:M.image_url,height:"100%",width:"100%",container:"",onReady:S,onClick:_,plugins:[[D,{}]]}),l&&e.jsxs("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"white",padding:"1.5rem",borderRadius:"8px",boxShadow:"0 4px 20px rgba(0,0,0,0.3)",width:"300px",zIndex:100},children:[e.jsx("h4",{children:"New Hotspot Details"}),e.jsxs("form",{onSubmit:N,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Label"}),e.jsx("input",{value:s.label,onChange:t=>r({...s,label:t.target.value}),placeholder:"e.g. Go to Hall",required:!0,autoFocus:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Target Scene"}),e.jsxs("select",{value:s.target_stop_id,onChange:t=>r({...s,target_stop_id:t.target.value}),required:!0,children:[e.jsx("option",{value:"",children:"-- Select Destination --"}),n.filter(t=>t.id!==o).map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"button",className:"btn btn-outline",onClick:()=>{d(!1),b(null)},children:"Cancel"}),e.jsxs("button",{type:"submit",className:"btn btn-primary",disabled:k,children:[e.jsx(P,{size:16})," Save"]})]})]})]})]}):e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"#666"},children:e.jsx("p",{children:"Select a scene from the sidebar to start editing."})})})]})};export{W as default};
