import{j as e,r as d,s as C,U as q,a as F,m as y,S as D,V as H,G as O,P as G}from"./index-DnZapYtk.js";import{A}from"./index-rVnNiGd9.js";import{M as Q}from"./mail-BDwb-jTg.js";const T=({items:r})=>e.jsxs("div",{className:"staff-carousel-container",children:[e.jsx("div",{className:"staff-carousel-track",children:r.map((x,t)=>e.jsx("div",{className:"staff-carousel-item",children:x},t))}),e.jsxs("div",{className:"staff-carousel-hint",children:[e.jsx("span",{className:"dot animate-pulse"}),e.jsx("span",{children:"Swipe to browse staff"})]}),e.jsx("style",{children:`
                .staff-carousel-container {
                    width: 100%;
                    overflow: hidden;
                    position: relative;
                    padding-bottom: 1rem;
                }
                .staff-carousel-track {
                    display: flex;
                    overflow-x: auto;
                    snap-type: x mandatory;
                    gap: 1.5rem;
                    padding: 1rem 0 2rem;
                    scrollbar-width: none;
                    -ms-overflow-style: none;
                }
                .staff-carousel-track::-webkit-scrollbar {
                    display: none;
                }
                .staff-carousel-item {
                    flex: 0 0 85%;
                    snap-align: center;
                    transform: scale(0.98);
                    transition: transform 0.3s ease;
                }
                .staff-carousel-item:active {
                    transform: scale(0.95);
                }
                .staff-carousel-hint {
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 0.5rem;
                    color: #94a3b8;
                    font-size: 0.7rem;
                    font-weight: 700;
                    text-transform: uppercase;
                    letter-spacing: 0.1em;
                }
                .dot {
                    width: 6px;
                    height: 6px;
                    background: #dc2626;
                    border-radius: 50%;
                }
                @keyframes pulse {
                    0%, 100% { transform: scale(1); opacity: 1; }
                    50% { transform: scale(1.5); opacity: 0.5; }
                }
                .animate-pulse {
                    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
                }
            `})]}),K=()=>{var R;const[r,x]=d.useState([]),[t,$]=d.useState([]),[f,z]=d.useState([]),[n,g]=d.useState(null),[p,b]=d.useState(null),[j,w]=d.useState(""),[L,P]=d.useState(!0);d.useEffect(()=>{B()},[]);const B=async()=>{try{const[s,a,i,c]=await Promise.all([C.from("departments").select("*").order("sort_order"),C.from("subjects").select("*").order("name"),C.from("teachers").select("*").order("hierarchy_order"),C.from("teacher_subjects").select("teacher_id, subject_id, role")]);if(s.error)throw s.error;if(a.error)throw a.error;if(i.error)throw i.error;if(c.error)throw c.error;const h=(i.data||[]).map(l=>{const o=(c.data||[]).filter(u=>u.teacher_id===l.id),S={};return o.forEach(u=>S[u.subject_id]=u.role||"teacher"),{...l,subject_ids:o.map(u=>u.subject_id),subject_roles:S}}).filter(l=>l.id!=="e376b0f7-ab4f-453f-9a1c-fa409e206c10");x(s.data||[]),$(a.data||[]),z(h)}catch(s){console.error("Error fetching departments data:",s)}finally{P(!1)}},k=d.useMemo(()=>{let s=f;if(n){const a=t.find(i=>i.id===n);a&&(s=s.filter(i=>(i.subject_ids||(i.primary_subject_id?[i.primary_subject_id]:[])).some(h=>{const l=t.find(o=>o.id===h);return(l==null?void 0:l.name)===a.name})))}return j&&(s=s.filter(a=>a.name.toLowerCase().includes(j.toLowerCase()))),s},[f,n,j,t]),I=d.useMemo(()=>f.filter(s=>{var a;return((a=s.role)==null?void 0:a.toLowerCase())==="hod"}),[f]),N=d.useMemo(()=>{const s={};return t.forEach(a=>{s[a.department_id]||(s[a.department_id]=[]),s[a.department_id].some(i=>i.name===a.name)||s[a.department_id].push(a)}),s},[t]),m=d.useMemo(()=>t.find(s=>s.id===n),[t,n]),v=d.useMemo(()=>m?k.find(s=>s.subject_roles?t.filter(i=>i.name===m.name).map(i=>i.id).some(i=>{var c;return((c=s.subject_roles)==null?void 0:c[i])==="hod"}):!1):null,[m,k,t]),E=d.useMemo(()=>{if(!m)return[];const s=v==null?void 0:v.id;return k.filter(a=>a.id!==s)},[m,k,v]);return L?e.jsx("div",{className:"departments-page flex items-center justify-center pt-24",children:e.jsx("div",{className:"w-10 h-10 border-4 border-slate-200 border-t-red-600 rounded-full animate-spin"})}):e.jsxs("main",{className:"departments-page pt-24",children:[e.jsxs("div",{className:"departments-container",children:[e.jsxs("aside",{className:"dept-sidebar",children:[e.jsx("div",{className:"sidebar-header",children:e.jsxs("button",{onClick:()=>{g(null),b(null)},className:`all-staff-btn ${n?"":"active"}`,children:[e.jsx(q,{size:18}),e.jsx("span",{children:"All Staff"})]})}),e.jsx("div",{className:"sidebar-content",children:r.map(s=>{var h,l;const a=p===s.id,i=t.find(o=>o.id===n),c=i&&((h=N[s.id])==null?void 0:h.some(o=>o.name===i.name));return e.jsxs("div",{className:"dept-nav-group",children:[e.jsxs("button",{onClick:()=>b(a?null:s.id),className:`dept-nav-header ${c||a?"active":""} ${a?"expanded":""}`,children:[e.jsx("h4",{children:s.name}),e.jsx(F,{size:20,className:`chevron-icon ${a?"rotate":""}`})]}),e.jsx(A,{children:a&&e.jsx(y.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"subject-nav-list",children:[(l=N[s.id])==null?void 0:l.map(o=>{var S,u;return e.jsxs("button",{onClick:()=>g(o.id),className:`subject-nav-btn ${((S=t.find(M=>M.id===n))==null?void 0:S.name)===o.name?"active":""}`,children:[((u=t.find(M=>M.id===n))==null?void 0:u.name)===o.name&&e.jsx(y.div,{layoutId:"active-indicator",className:"active-indicator"}),o.name]},o.id)}),(!N[s.id]||N[s.id].length===0)&&e.jsx("div",{className:"empty-state",style:{padding:"1rem",fontSize:"0.75rem"},children:"No subjects listed"})]})})})]},s.id)})})]}),e.jsxs("div",{className:"mobile-nav",children:[e.jsxs("div",{className:"mobile-dept-scroll no-scrollbar",children:[e.jsx("button",{onClick:()=>{g(null),b(null)},className:`mobile-dept-btn ${n?"":"active"}`,children:"All Staff"}),r.map(s=>{var h;const a=p===s.id,i=t.find(l=>l.id===n),c=i&&((h=N[s.id])==null?void 0:h.some(l=>l.name===i.name))||a;return e.jsx("button",{onClick:()=>b(p===s.id?null:s.id),className:`mobile-dept-btn ${c?"active":""}`,children:s.name},s.id)})]}),e.jsx(A,{children:p&&e.jsx(y.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"mobile-subject-scroll no-scrollbar",children:(R=N[p])==null?void 0:R.map(s=>{var a;return e.jsx("button",{onClick:()=>g(s.id),className:`mobile-subject-btn ${((a=t.find(i=>i.id===n))==null?void 0:a.name)===s.name?"active":""}`,children:s.name},s.id)})})}),e.jsx("div",{className:"mobile-search-wrapper",children:e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(D,{className:"search-icon",size:16}),e.jsx("input",{type:"text",placeholder:"Search teacher...",value:j,onChange:s=>w(s.target.value),className:"dept-search-input"})]})})]}),e.jsx("div",{className:"departments-main",children:e.jsxs("div",{className:"content-inner",children:[e.jsx("div",{className:"desktop-search search-section",children:e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(D,{className:"search-icon",size:20}),e.jsx("input",{type:"text",placeholder:"Browse teachers by name...",value:j,onChange:s=>w(s.target.value),className:"dept-search-input"})]})}),e.jsx("div",{className:"main-content-results",children:e.jsx(A,{mode:"wait",children:n?e.jsxs(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"results-section",children:[e.jsxs("div",{className:"subject-header",children:[e.jsx("h1",{className:"subject-title",children:m==null?void 0:m.name}),e.jsx("span",{className:"hierarchy-badge",children:"Academic Faculty"})]}),v&&e.jsxs("div",{className:"hod-container",children:[e.jsx("span",{className:"hod-label",children:"Head of Subject"}),e.jsx(_,{teacher:v,isLarge:!0,showRole:!0,subjectName:m==null?void 0:m.name}),e.jsx("div",{className:"connector-line"})]}),e.jsxs("div",{className:"staff-section",children:[e.jsx("span",{className:"staff-label",children:"Department Staff"}),E.length===0?e.jsx("p",{className:"empty-state",children:"No other staff members listed for this subject yet."}):e.jsxs("div",{className:"teacher-grid",children:[e.jsx("div",{className:"lg:hidden",style:{gridColumn:"1 / -1"},children:e.jsx(T,{items:E.map(s=>e.jsx(_,{teacher:s,availableSubjects:t},s.id))})}),E.map(s=>e.jsx("div",{className:"hidden lg:block",children:e.jsx(_,{teacher:s,availableSubjects:t})},s.id))]})]})]},n):e.jsxs(y.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"results-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h1",{className:"section-title",children:"Academic Heads"}),e.jsx("div",{className:"title-underline"})]}),e.jsxs("div",{className:"teacher-grid",children:[e.jsx("div",{className:"lg:hidden",style:{gridColumn:"1 / -1"},children:e.jsx(T,{items:I.map(s=>{var i;const a=(i=t.find(c=>c.id===s.primary_subject_id))==null?void 0:i.name;return e.jsx(_,{teacher:s,showRole:!0,subjectName:a,availableSubjects:t},s.id)})})}),I.map(s=>{var i;const a=(i=t.find(c=>c.id===s.primary_subject_id))==null?void 0:i.name;return e.jsx("div",{className:"hidden lg:block",children:e.jsx(_,{teacher:s,showRole:!0,subjectName:a,availableSubjects:t})},s.id)})]})]},"all-hods")})})]})})]}),e.jsx(H,{})]})},_=({teacher:r,isLarge:x=!1,showRole:t=!1,subjectName:$,availableSubjects:f})=>{const z=d.useMemo(()=>{if(!f)return[];const p=(r.subject_ids||(r.primary_subject_id?[r.primary_subject_id]:[])).map(b=>{var j;return(j=f.find(w=>w.id===b))==null?void 0:j.name}).filter(Boolean);return[...new Set(p)]},[r,f]),n=$||z.join(" & ")||"Faculty";return e.jsxs(y.div,{whileHover:{y:-5},className:`staff-card ${x?"large-card":""}`,children:[e.jsx("div",{className:"staff-card-image",children:r.image_url?e.jsx("img",{src:r.image_url,alt:r.name}):e.jsx("div",{className:"staff-placeholder",children:e.jsx(q,{size:x?64:48})})}),e.jsxs("div",{className:`staff-card-body ${t?"hod-bg":""}`,children:[e.jsxs("div",{className:"staff-info-header",children:[e.jsx("span",{className:"staff-subject-tag",children:t?`HOD ${n}`:n}),e.jsxs("h3",{className:"staff-name",children:[r.title," ",r.name]})]}),e.jsxs("div",{className:"staff-details",children:[r.qualification&&e.jsxs("div",{className:"staff-qualification",children:[e.jsx(O,{size:16}),e.jsx("span",{children:r.qualification})]}),e.jsxs("div",{className:"staff-actions",children:[r.email&&e.jsxs("a",{href:`mailto:${r.email}`,className:"staff-action-link",children:[e.jsx(Q,{size:14}),e.jsx("span",{className:"staff-action-text",children:"Email"})]}),r.phone&&e.jsxs("a",{href:`tel:${r.phone}`,className:"staff-action-link",children:[e.jsx(G,{size:14}),e.jsx("span",{className:"staff-action-text",children:"Call"})]})]})]})]})]})};export{K as default};
