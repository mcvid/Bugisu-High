import{d as j,H as y,r as l,s as d,j as e}from"./index-DqW8wV2_.js";import{c as b}from"./cache-BThuL7vy.js";import{A as E}from"./arrow-left-J1rdd-IM.js";import{S}from"./save-DIULZghB.js";const _=()=>{const{id:i}=j(),m=y(),c=!!i,[t,h]=l.useState({title:"",event_date:"",location:"",category:"General",description:""}),[v,o]=l.useState(!1),[u,x]=l.useState(null);l.useEffect(()=>{c&&p()},[i]);const p=async()=>{try{o(!0);const{data:n,error:r}=await d.from("events").select("*").eq("id",i).single();if(r)throw r;const a=new Date(n.event_date);a.setMinutes(a.getMinutes()-a.getTimezoneOffset());const f=a.toISOString().slice(0,16);h({...n,event_date:f})}catch(n){console.error("Error fetching event:",n),x("Could not load event.")}finally{o(!1)}},s=n=>{h({...t,[n.target.name]:n.target.value})},g=async n=>{n.preventDefault(),o(!0);try{const r={title:t.title,event_date:new Date(t.event_date).toISOString(),location:t.location,category:t.category,description:t.description};if(c){const{error:a}=await d.from("events").update(r).eq("id",i);if(a)throw a}else{const{error:a}=await d.from("events").insert(r);if(a)throw a}b.invalidate("home_data"),m("/admin/events")}catch(r){x(r.message)}finally{o(!1)}};return e.jsxs("div",{className:"admin-page admin-fade-in",children:[e.jsx("div",{className:"admin-header",children:e.jsxs("div",{children:[e.jsx("button",{onClick:()=>m("/admin/events"),className:"btn btn-icon",style:{marginBottom:"1rem",color:"#64748b"},children:e.jsx(E,{size:20})}),e.jsx("h1",{children:c?"Edit Event":"Add Event"})]})}),e.jsxs("div",{className:"admin-form-container",style:{maxWidth:"600px"},children:[u&&e.jsx("div",{style:{color:"red",marginBottom:"1rem"},children:u}),e.jsxs("form",{onSubmit:g,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Event Title"}),e.jsx("input",{name:"title",value:t.title,onChange:s,required:!0})]}),e.jsxs("div",{className:"form-grid",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Date & Time"}),e.jsx("input",{type:"datetime-local",name:"event_date",value:t.event_date,onChange:s,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category"}),e.jsxs("select",{name:"category",value:t.category,onChange:s,children:[e.jsx("option",{value:"General",children:"General"}),e.jsx("option",{value:"Academics",children:"Academics"}),e.jsx("option",{value:"Term Dates",children:"Term Dates"}),e.jsx("option",{value:"Holiday",children:"Holiday"}),e.jsx("option",{value:"Exam",children:"Exam"}),e.jsx("option",{value:"Sports",children:"Sports"}),e.jsx("option",{value:"Other",children:"Other"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Location"}),e.jsx("input",{name:"location",value:t.location,onChange:s,placeholder:"e.g. Main Hall"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{name:"description",value:t.description,onChange:s,rows:4})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:v,style:{width:"100%"},children:v?"Saving...":e.jsxs(e.Fragment,{children:[e.jsx(S,{size:18})," Save Event"]})})]})]})]})};export{_ as default};
