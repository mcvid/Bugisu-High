import{r as a,s as n,j as e,F as D}from"./index-EH-KDdP-.js";import{U as T}from"./upload-ny2dlU1l.js";import{D as P}from"./download-DrfUKMba.js";import{T as F}from"./trash-2-DWd29h3p.js";const q=()=>{const[y,b]=a.useState([]),[S,u]=a.useState(!0),[h,m]=a.useState(!1),[r,t]=a.useState({title:"",subject:"",level:"S1",year:new Date().getFullYear(),term:"1",paper_type:"Exam"}),[o,x]=a.useState(null),[j,L]=a.useState(""),[d,w]=a.useState("All");a.useEffect(()=>{c()},[]);const c=async()=>{u(!0);const{data:l,error:s}=await n.from("past_papers").select("*").order("created_at",{ascending:!1});l&&b(l),s&&console.error("Error fetching papers:",s),u(!1)},N=l=>{l.target.files&&l.target.files[0]&&x(l.target.files[0])},C=async l=>{if(l.preventDefault(),!o)return alert("Please select a file to upload");m(!0);try{const s=o.name.split(".").pop(),i=`${r.subject}_${r.level}_${Date.now()}.${s}`.replace(/\s+/g,"_"),{data:p,error:v}=await n.storage.from("academic_resources").upload(i,o);if(v)throw v;const{data:_}=n.storage.from("academic_resources").getPublicUrl(i),{error:f}=await n.from("past_papers").insert([{...r,file_url:_.publicUrl,year:parseInt(r.year),term:parseInt(r.term)}]);if(f)throw f;t({title:"",subject:"",level:"S1",year:new Date().getFullYear(),term:"1",paper_type:"Exam"}),x(null),c(),alert("Past paper uploaded successfully!")}catch(s){console.error("Error uploading paper:",s),alert("Failed to upload paper. "+s.message)}finally{m(!1)}},E=async(l,s)=>{if(window.confirm("Are you sure you want to delete this paper?"))try{const{error:i}=await n.from("past_papers").delete().eq("id",l);if(i)throw i;const p=s.split("/").pop();p&&await n.storage.from("academic_resources").remove([p]),c()}catch(i){console.error("Error deleting paper:",i),alert("Error deleting paper")}},g=y.filter(l=>(d==="All"||l.level===d)&&(j===""||l.subject.toLowerCase().includes(j.toLowerCase())));return e.jsxs("div",{className:"admin-manager",children:[e.jsxs("div",{className:"admin-header",children:[e.jsx("h1",{children:"Academic Resources Manager"}),e.jsx("p",{children:"Upload and manage past papers and study materials."})]}),e.jsxs("div",{className:"admin-grid",children:[e.jsxs("div",{className:"admin-card",children:[e.jsx("h3",{children:"Upload New Paper"}),e.jsxs("form",{onSubmit:C,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Title / Description"}),e.jsx("input",{type:"text",placeholder:"e.g. End of Term Mathematics Exam",required:!0,value:r.title,onChange:l=>t({...r,title:l.target.value})})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Subject"}),e.jsxs("select",{required:!0,value:r.subject,onChange:l=>t({...r,subject:l.target.value}),children:[e.jsx("option",{value:"",children:"Select Subject"}),e.jsx("option",{value:"General",children:"General"}),e.jsx("option",{value:"Mathematics",children:"Mathematics"}),e.jsx("option",{value:"English",children:"English"}),e.jsx("option",{value:"Physics",children:"Physics"}),e.jsx("option",{value:"Chemistry",children:"Chemistry"}),e.jsx("option",{value:"Biology",children:"Biology"}),e.jsx("option",{value:"History",children:"History"}),e.jsx("option",{value:"Geography",children:"Geography"}),e.jsx("option",{value:"Commerce",children:"Commerce"}),e.jsx("option",{value:"Computer Studies",children:"Computer Studies"}),e.jsx("option",{value:"Literature",children:"Literature"}),e.jsx("option",{value:"Luganda",children:"Luganda"}),e.jsx("option",{value:"Swahili",children:"Swahili"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Level"}),e.jsxs("select",{value:r.level,onChange:l=>t({...r,level:l.target.value}),children:[e.jsx("option",{value:"S1",children:"Senior 1"}),e.jsx("option",{value:"S2",children:"Senior 2"}),e.jsx("option",{value:"S3",children:"Senior 3"}),e.jsx("option",{value:"S4",children:"Senior 4"}),e.jsx("option",{value:"S5",children:"Senior 5"}),e.jsx("option",{value:"S6",children:"Senior 6"})]})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Year"}),e.jsx("input",{type:"number",required:!0,min:"2000",max:"2030",value:r.year,onChange:l=>t({...r,year:l.target.value})})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Term"}),e.jsxs("select",{value:r.term,onChange:l=>t({...r,term:l.target.value}),children:[e.jsx("option",{value:"1",children:"Term 1"}),e.jsx("option",{value:"2",children:"Term 2"}),e.jsx("option",{value:"3",children:"Term 3"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Type"}),e.jsxs("select",{value:r.paper_type,onChange:l=>t({...r,paper_type:l.target.value}),children:[e.jsx("option",{value:"Exam",children:"Exam Paper"}),e.jsx("option",{value:"Test",children:"Monthly Test"}),e.jsx("option",{value:"Assignment",children:"Holiday Work / Assignment"}),e.jsx("option",{value:"Notes",children:"Class Notes"}),e.jsx("option",{value:"Timetable",children:"Exam Timetable"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Document File (PDF/Word)"}),e.jsxs("div",{className:"file-upload-wrapper",children:[e.jsx("input",{type:"file",required:!0,accept:".pdf,.doc,.docx",onChange:N}),e.jsxs("div",{className:"file-upload-placeholder",children:[e.jsx(T,{size:24}),e.jsx("span",{children:o?o.name:"Click to select file"})]})]})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",disabled:h,children:h?"Uploading...":"Upload Paper"})]})]}),e.jsxs("div",{className:"admin-card",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{children:"Manage Resources"}),e.jsx("div",{style:{display:"flex",gap:"0.5rem"},children:e.jsxs("select",{value:d,onChange:l=>w(l.target.value),style:{padding:"0.5rem",borderRadius:"4px",border:"1px solid #ddd"},children:[e.jsx("option",{value:"All",children:"All Levels"}),e.jsx("option",{value:"S1",children:"S1"}),e.jsx("option",{value:"S2",children:"S2"}),e.jsx("option",{value:"S3",children:"S3"}),e.jsx("option",{value:"S4",children:"S4"}),e.jsx("option",{value:"S5",children:"S5"}),e.jsx("option",{value:"S6",children:"S6"})]})})]}),e.jsx("div",{className:"papers-list",children:S?e.jsx("p",{children:"Loading..."}):g.length===0?e.jsx("p",{children:"No papers found."}):e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{background:"#f8fafc",textAlign:"left"},children:[e.jsx("th",{style:{padding:"0.75rem"},children:"Title"}),e.jsx("th",{style:{padding:"0.75rem"},children:"Subject"}),e.jsx("th",{style:{padding:"0.75rem"},children:"Class"}),e.jsx("th",{style:{padding:"0.75rem"},children:"Year"}),e.jsx("th",{style:{padding:"0.75rem"},children:"Downloads"}),e.jsx("th",{style:{padding:"0.75rem"},children:"Actions"})]})}),e.jsx("tbody",{children:g.map(l=>e.jsxs("tr",{style:{borderBottom:"1px solid #eee"},children:[e.jsx("td",{style:{padding:"0.75rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(D,{size:16,color:"#475569"}),l.title]})}),e.jsx("td",{style:{padding:"0.75rem"},children:l.subject}),e.jsx("td",{style:{padding:"0.75rem"},children:e.jsx("span",{className:"badge badge-blue",children:l.level})}),e.jsx("td",{style:{padding:"0.75rem"},children:l.year}),e.jsx("td",{style:{padding:"0.75rem"},children:l.downloads}),e.jsx("td",{style:{padding:"0.75rem"},children:e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("a",{href:l.file_url,target:"_blank",rel:"noopener noreferrer",className:"btn-icon",title:"Download/View",children:e.jsx(P,{size:16})}),e.jsx("button",{className:"btn-icon delete",onClick:()=>E(l.id,l.file_url),title:"Delete",children:e.jsx(F,{size:16})})]})})]},l.id))})]})})]})]})]})};export{q as default};
