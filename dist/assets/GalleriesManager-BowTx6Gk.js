import{c as q,r as o,s as i,j as e,f as G,C as L}from"./index-DqW8wV2_.js";/* empty css                    */import{S as M}from"./save-DIULZghB.js";import{T as E}from"./trash-2-C5gPLAv6.js";import{U as W}from"./upload-BzUEY58p.js";/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=q("FolderPlus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),Q=()=>{const[g,x]=o.useState([]),[n,y]=o.useState(null),[d,m]=o.useState([]),[k,b]=o.useState(!0),[f,w]=o.useState(!1),[j,C]=o.useState(!1),[v,s]=o.useState({type:"",text:""}),[l,p]=o.useState({title:"",description:"",category:"",event_date:"",cover_image_url:""});o.useEffect(()=>{I()},[]);const I=async()=>{try{b(!0);const{data:r,error:t}=await i.from("galleries").select("*").order("event_date",{ascending:!1});if(t)throw t;x(r||[])}catch(r){console.error("Error fetching galleries:",r),s({type:"error",text:"Failed to load galleries"})}finally{b(!1)}},z=async r=>{try{const{data:t,error:a}=await i.from("gallery_images").select("*").eq("gallery_id",r).order("sort_order",{ascending:!0});if(a)throw a;m(t||[])}catch(t){console.error("Error fetching gallery images:",t)}},D=async r=>{r.preventDefault(),s({type:"",text:""});try{const{data:t,error:a}=await i.from("galleries").insert([l]).select().single();if(a)throw a;x([t,...g]),C(!1),p({title:"",description:"",category:"",event_date:"",cover_image_url:""}),s({type:"success",text:"Gallery created successfully!"})}catch(t){console.error("Error creating gallery:",t),s({type:"error",text:"Failed to create gallery"})}},U=async r=>{if(window.confirm("Delete this gallery and all its images?"))try{const{error:t}=await i.from("galleries").delete().eq("id",r);if(t)throw t;x(g.filter(a=>a.id!==r)),(n==null?void 0:n.id)===r&&(y(null),m([])),s({type:"success",text:"Gallery deleted successfully!"})}catch(t){console.error("Error deleting gallery:",t),s({type:"error",text:"Failed to delete gallery"})}},F=async r=>{const t=Array.from(r.target.files);if(!(!t.length||!n)){w(!0),s({type:"",text:""});try{const a=t.map(async(u,h)=>{const $=u.name.split(".").pop(),N=`galleries/${n.id}/${Date.now()}_${h}.${$}`,{error:_}=await i.storage.from("galleries").upload(N,u);if(_)throw _;const{data:{publicUrl:A}}=i.storage.from("galleries").getPublicUrl(N),{data:B,error:S}=await i.from("gallery_images").insert([{gallery_id:n.id,image_url:A,caption:"",sort_order:d.length+h}]).select().single();if(S)throw S;return B}),c=await Promise.all(a);m([...d,...c]),s({type:"success",text:`${t.length} image(s) uploaded successfully!`})}catch(a){console.error("Error uploading images:",a),s({type:"error",text:"Failed to upload images"})}finally{w(!1),r.target.value=null}}},T=async r=>{if(window.confirm("Delete this image?"))try{const{error:t}=await i.from("gallery_images").delete().eq("id",r);if(t)throw t;m(d.filter(a=>a.id!==r)),s({type:"success",text:"Image deleted successfully!"})}catch(t){console.error("Error deleting image:",t),s({type:"error",text:"Failed to delete image"})}},P=async(r,t)=>{try{const{error:a}=await i.from("gallery_images").update({caption:t}).eq("id",r);if(a)throw a;m(d.map(c=>c.id===r?{...c,caption:t}:c))}catch(a){console.error("Error updating caption:",a)}},R=async r=>{const t=r.target.files[0];if(t)try{const a=t.name.split(".").pop(),c=`galleries/covers/${Date.now()}.${a}`,{error:u}=await i.storage.from("galleries").upload(c,t);if(u)throw u;const{data:{publicUrl:h}}=i.storage.from("galleries").getPublicUrl(c);p({...l,cover_image_url:h})}catch(a){console.error("Error uploading cover:",a),s({type:"error",text:"Failed to upload cover image"})}};return k?e.jsx("div",{className:"admin-content",children:e.jsx("div",{className:"admin-loading",children:"Loading..."})}):e.jsxs("div",{className:"admin-content",children:[e.jsxs("div",{className:"admin-header",children:[e.jsxs("div",{children:[e.jsx("h1",{children:"Photo Galleries Manager"}),e.jsx("p",{className:"admin-subtitle",children:"Manage photo albums and images"})]}),e.jsxs("button",{className:"btn btn-primary",onClick:()=>C(!j),children:[e.jsx(H,{size:18}),j?"Cancel":"New Gallery"]})]}),v.text&&e.jsx("div",{className:`alert alert-${v.type}`,style:{marginBottom:"1.5rem"},children:v.text}),j&&e.jsxs("div",{className:"admin-card",style:{marginBottom:"2rem"},children:[e.jsx("h3",{children:"Create New Gallery"}),e.jsxs("form",{onSubmit:D,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Gallery Title *"}),e.jsx("input",{type:"text",value:l.title,onChange:r=>p({...l,title:r.target.value}),className:"form-input",required:!0,placeholder:"e.g., Sports Day 2024"})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{value:l.description,onChange:r=>p({...l,description:r.target.value}),className:"form-input",rows:"3",placeholder:"Brief description of this gallery..."})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category"}),e.jsxs("select",{value:l.category,onChange:r=>p({...l,category:r.target.value}),className:"form-input",children:[e.jsx("option",{value:"",children:"Select category..."}),e.jsx("option",{value:"Events",children:"Events"}),e.jsx("option",{value:"Sports",children:"Sports"}),e.jsx("option",{value:"Academics",children:"Academics"}),e.jsx("option",{value:"Campus Life",children:"Campus Life"}),e.jsx("option",{value:"Ceremonies",children:"Ceremonies"}),e.jsx("option",{value:"Clubs",children:"Clubs"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Event Date"}),e.jsx("input",{type:"date",value:l.event_date,onChange:r=>p({...l,event_date:r.target.value}),className:"form-input"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Cover Image"}),e.jsx("input",{type:"file",accept:"image/*",onChange:R,className:"form-input"}),l.cover_image_url&&e.jsx("img",{src:l.cover_image_url,alt:"Cover preview",style:{maxWidth:"200px",marginTop:"0.5rem",borderRadius:"8px"}})]}),e.jsx("div",{className:"form-actions",children:e.jsxs("button",{type:"submit",className:"btn btn-primary",children:[e.jsx(M,{size:18}),"Create Gallery"]})})]})]}),n?e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-outline",onClick:()=>{y(null),m([])},style:{marginBottom:"1.5rem"},children:"â† Back to Galleries"}),e.jsxs("div",{className:"admin-card",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1.5rem"},children:[e.jsxs("div",{children:[e.jsx("h3",{children:n.title}),e.jsxs("p",{style:{color:"#64748b",margin:"0.5rem 0 0 0"},children:[d.length," image(s)"]})]}),e.jsxs("div",{children:[e.jsx("input",{type:"file",id:"image-upload",accept:"image/*",multiple:!0,onChange:F,style:{display:"none"},disabled:f}),e.jsxs("label",{htmlFor:"image-upload",className:"btn btn-primary",style:{cursor:f?"not-allowed":"pointer"},children:[e.jsx(W,{size:18}),f?"Uploading...":"Upload Images"]})]})]}),d.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"3rem",color:"#64748b"},children:[e.jsx(G,{size:48,style:{margin:"0 auto 1rem"}}),e.jsx("p",{children:"No images in this gallery yet. Upload some!"})]}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"1.5rem"},children:d.map(r=>e.jsxs("div",{style:{position:"relative"},children:[e.jsx("img",{src:r.image_url,alt:r.caption,style:{width:"100%",aspectRatio:"1",objectFit:"cover",borderRadius:"8px"}}),e.jsx("button",{onClick:()=>T(r.id),style:{position:"absolute",top:"8px",right:"8px",background:"rgba(255, 255, 255, 0.95)",border:"none",borderRadius:"50%",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#dc2626"},children:e.jsx(E,{size:16})}),e.jsx("input",{type:"text",value:r.caption||"",onChange:t=>P(r.id,t.target.value),placeholder:"Add caption...",style:{width:"100%",marginTop:"0.5rem",padding:"0.5rem",border:"1px solid #e2e8f0",borderRadius:"6px",fontSize:"0.875rem"}})]},r.id))})]})]}):e.jsxs("div",{className:"admin-card",children:[e.jsxs("h3",{children:["All Galleries (",g.length,")"]}),g.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"3rem",color:"#64748b"},children:[e.jsx(G,{size:48,style:{margin:"0 auto 1rem"}}),e.jsx("p",{children:"No galleries yet. Create your first gallery!"})]}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(280px, 1fr))",gap:"1.5rem",marginTop:"1.5rem"},children:g.map(r=>e.jsxs("div",{style:{border:"1px solid #e2e8f0",borderRadius:"12px",overflow:"hidden",cursor:"pointer",transition:"all 0.2s ease"},onClick:()=>{y(r),z(r.id)},children:[e.jsx("div",{style:{height:"180px",backgroundImage:`url(${r.cover_image_url||"https://images.unsplash.com/photo-1523050854058-8df90110c9f1?auto=format&fit=crop&q=80"})`,backgroundSize:"cover",backgroundPosition:"center"}}),e.jsxs("div",{style:{padding:"1rem"},children:[e.jsx("h4",{style:{marginBottom:"0.5rem"},children:r.title}),r.category&&e.jsx("span",{style:{display:"inline-block",padding:"0.25rem 0.75rem",background:"#eff6ff",color:"#1e90ff",borderRadius:"12px",fontSize:"0.75rem",fontWeight:"600",marginBottom:"0.5rem"},children:r.category}),r.event_date&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",color:"#64748b",fontSize:"0.85rem"},children:[e.jsx(L,{size:14}),new Date(r.event_date).toLocaleDateString()]}),e.jsxs("button",{onClick:t=>{t.stopPropagation(),U(r.id)},style:{marginTop:"0.75rem",padding:"0.5rem",background:"#fee2e2",color:"#dc2626",border:"none",borderRadius:"6px",cursor:"pointer",width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",fontSize:"0.875rem",fontWeight:"600"},children:[e.jsx(E,{size:14}),"Delete Gallery"]})]})]},r.id))})]})]})};export{Q as default};
