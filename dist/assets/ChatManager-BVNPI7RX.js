import{r as i,s as r,j as e,g as _,M as w}from"./index-EH-KDdP-.js";/* empty css                    */import{U as S}from"./user-Cqkhr_uV.js";import{M as R}from"./mail-kSsI-FuV.js";const T=()=>{const[d,x]=i.useState([]),[s,h]=i.useState(null),[l,c]=i.useState([]),[a,p]=i.useState(""),[D,u]=i.useState(!0),m=i.useRef(null);i.useEffect(()=>{f();const t=r.channel("admin-sessions").on("postgres_changes",{event:"*",schema:"public",table:"chat_sessions"},()=>f()).subscribe();return()=>r.removeChannel(t)},[]),i.useEffect(()=>{if(s){g(s.id);const t=y(s.id);return()=>r.removeChannel(t)}},[s]),i.useEffect(()=>{var t;(t=m.current)==null||t.scrollIntoView({behavior:"smooth"})},[l]);const f=async()=>{const{data:t}=await r.from("chat_sessions").select("*").order("updated_at",{ascending:!1});t&&x(t),u(!1)},g=async t=>{const{data:n}=await r.from("chat_messages").select("*").eq("session_id",t).order("created_at",{ascending:!0});n&&c(n)},y=t=>r.channel(`admin-chat:${t}`).on("postgres_changes",{event:"INSERT",schema:"public",table:"chat_messages",filter:`session_id=eq.${t}`},o=>{c(v=>[...v,o.new]),o.new.sender_type==="user"&&b(o.new.id)}).subscribe(),b=async t=>{await r.from("chat_messages").update({is_read:!0}).eq("id",t)},j=async t=>{if(t.preventDefault(),!(!a.trim()||!s))try{const{error:n}=await r.from("chat_messages").insert([{session_id:s.id,sender_type:"admin",content:a,is_read:!0}]);if(n)throw n;await r.from("chat_sessions").update({updated_at:new Date().toISOString()}).eq("id",s.id),p("")}catch(n){console.error("Error sending reply:",n)}};return e.jsxs("div",{className:"admin-content",style:{height:"calc(100vh - 2rem)",display:"flex",flexDirection:"column",padding:0},children:[e.jsx("div",{className:"admin-header",style:{padding:"1.5rem",borderBottom:"1px solid #e2e8f0"},children:e.jsxs("div",{children:[e.jsx("h1",{children:"Live Chat Support"}),e.jsx("p",{className:"admin-subtitle",children:"Real-time communication with visitors"})]})}),e.jsxs("div",{style:{display:"flex",flex:1,overflow:"hidden"},children:[e.jsxs("div",{style:{width:"300px",borderRight:"1px solid #e2e8f0",display:"flex",flexDirection:"column",background:"white"},children:[e.jsx("div",{style:{padding:"1rem",borderBottom:"1px solid #f1f5f9"},children:e.jsx("h3",{className:"text-sm uppercase text-gray-500 font-semibold",children:"Active Conversations"})}),e.jsx("div",{style:{overflowY:"auto",flex:1},children:d.length===0?e.jsx("p",{style:{padding:"1rem",color:"#94a3b8",textAlign:"center"},children:"No active chats"}):d.map(t=>e.jsxs("div",{onClick:()=>h(t),style:{padding:"1rem",borderBottom:"1px solid #f1f5f9",cursor:"pointer",background:(s==null?void 0:s.id)===t.id?"#eff6ff":"white",borderLeft:(s==null?void 0:s.id)===t.id?"4px solid #1e90ff":"4px solid transparent"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.25rem"},children:[e.jsx("span",{style:{fontWeight:600,color:"#1e293b"},children:t.user_name}),e.jsx("span",{style:{fontSize:"0.75rem",color:"#94a3b8"},children:new Date(t.updated_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("p",{style:{fontSize:"0.85rem",color:"#64748b",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:t.user_email||"No email provided"})]},t.id))})]}),e.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",background:"#f8fafc"},children:s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{padding:"1rem",background:"white",borderBottom:"1px solid #e2e8f0",display:"flex",alignItems:"center",gap:"1rem"},children:[e.jsx("div",{style:{width:"40px",height:"40px",background:"#e2e8f0",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(S,{size:20,color:"#64748b"})}),e.jsxs("div",{children:[e.jsx("h3",{style:{margin:0,fontSize:"1rem"},children:s.user_name}),e.jsx("span",{style:{fontSize:"0.85rem",color:"#64748b"},children:s.user_email})]}),s.user_email&&e.jsxs("a",{href:`mailto:${s.user_email}?subject=Reply to your chat with Bugisu High School&body=Hi ${s.user_name},%0D%0A%0D%0A`,style:{marginLeft:"auto",display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem 1rem",background:"#f1f5f9",borderRadius:"6px",fontSize:"0.85rem",color:"#1e40af",textDecoration:"none",fontWeight:500},children:[e.jsx(R,{size:16})," Reply via Email"]})]}),e.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"1.5rem",display:"flex",flexDirection:"column",gap:"1rem"},children:[l.map(t=>e.jsxs("div",{style:{alignSelf:t.sender_type==="admin"?"flex-end":"flex-start",maxWidth:"70%",display:"flex",flexDirection:"column",alignItems:t.sender_type==="admin"?"flex-end":"flex-start"},children:[e.jsx("div",{style:{padding:"0.75rem 1rem",borderRadius:"12px",background:t.sender_type==="admin"?"#1e90ff":"white",color:t.sender_type==="admin"?"white":"#1e293b",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",borderTopRightRadius:t.sender_type==="admin"?"2px":"12px",borderTopLeftRadius:t.sender_type==="admin"?"12px":"2px"},children:t.content}),e.jsx("span",{style:{fontSize:"0.7rem",color:"#94a3b8",marginTop:"0.25rem"},children:new Date(t.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]},t.id)),e.jsx("div",{ref:m})]}),e.jsx("div",{style:{padding:"1rem",background:"white",borderTop:"1px solid #e2e8f0"},children:e.jsxs("form",{onSubmit:j,style:{display:"flex",gap:"1rem"},children:[e.jsx("input",{type:"text",value:a,onChange:t=>p(t.target.value),placeholder:"Type your reply...",style:{flex:1,padding:"0.75rem 1rem",borderRadius:"50px",border:"1px solid #e2e8f0",outline:"none"}}),e.jsxs("button",{type:"submit",disabled:!a.trim(),className:"btn btn-primary",style:{borderRadius:"50px",padding:"0 1.5rem"},children:[e.jsx(_,{size:18})," Send"]})]})})]}):e.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"#94a3b8"},children:[e.jsx(w,{size:48,style:{marginBottom:"1rem",opacity:.5}}),e.jsx("p",{children:"Select a conversation to start chatting"})]})})]})]})};export{T as default};
