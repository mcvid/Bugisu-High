import{r as d,s as n,j as e,a5 as U,U as R,X as F,P as O}from"./index-DnZapYtk.js";import{P as B}from"./pencil-DM79N96B.js";import{F as H}from"./filter-ZkGmXdqF.js";import{U as $}from"./upload-BXbAIg_5.js";import{S as L}from"./save-BWmYaoU4.js";import{M as J}from"./mail-BDwb-jTg.js";import{T as Q}from"./trash-2-CjA1UK2C.js";const re=()=>{const[f,S]=d.useState([]),[y,E]=d.useState([]),[h,I]=d.useState([]),[M,_]=d.useState(!0),[g,w]=d.useState(!1),[c,z]=d.useState(null),[m,b]=d.useState(new Set),[j,v]=d.useState(""),[i,s]=d.useState({name:"",title:"Mr.",role:"teacher",department_id:"",primary_subject_id:"",qualification:"",email:"",phone:"",image_url:"",hierarchy_order:0});d.useEffect(()=>{T()},[]);const T=async()=>{_(!0);try{const[r,t,a]=await Promise.all([n.from("teachers").select("*, teacher_subjects(subject_id)").order("hierarchy_order",{ascending:!0}),n.from("departments").select("*").order("name",{ascending:!0}),n.from("subjects").select("*").order("name",{ascending:!0})]);r.data&&S(r.data),t.data&&E(t.data),a.data&&I(a.data)}catch(r){console.error("Error fetching data:",r)}finally{_(!1)}},P=async r=>{const t=r.target.files[0];if(t){w(!0);try{const a=t.name.split(".").pop(),p=`teachers/${`${Math.random()}.${a}`}`,{error:u}=await n.storage.from("images").upload(p,t);if(u)throw u;const{data:{publicUrl:l}}=n.storage.from("images").getPublicUrl(p);s({...i,image_url:l})}catch(a){console.error("Error uploading image:",a),alert("Upload failed!")}finally{w(!1)}}},N=r=>{const t=new Set(m);t.has(r)?(t.delete(r),i.primary_subject_id===r&&s({...i,primary_subject_id:""})):(t.add(r),t.size===1&&s({...i,primary_subject_id:r})),b(t)},W=async r=>{var t;if(r.preventDefault(),!!i.name)try{const a=((t=h.find(l=>l.id===i.primary_subject_id))==null?void 0:t.name)||"",o={...i,subject:a};let p=c;if(c){const{error:l}=await n.from("teachers").update(o).eq("id",c);if(l)throw l}else{const{data:l,error:x}=await n.from("teachers").insert([o]).select().single();if(x)throw x;p=l.id}const{error:u}=await n.from("teacher_subjects").delete().eq("teacher_id",p);if(u)throw u;if(m.size>0){const l=Array.from(m).map(D=>({teacher_id:p,subject_id:D,role:i.role==="hod"&&D===i.primary_subject_id?"hod":"teacher"})),{error:x}=await n.from("teacher_subjects").insert(l);if(x)throw x}C(),T(),alert(c?"Teacher updated successfully!":"Teacher added successfully!")}catch(a){console.error("Error saving teacher:",a),alert("Save failed! "+a.message)}},q=r=>{var a;z(r.id),s({name:r.name,title:r.title||"Mr.",role:r.role||"teacher",department_id:r.department_id||"",primary_subject_id:r.primary_subject_id||"",qualification:r.qualification||"",email:r.email||"",phone:r.phone||"",image_url:r.image_url||"",hierarchy_order:r.hierarchy_order||0});const t=((a=r.teacher_subjects)==null?void 0:a.map(o=>o.subject_id))||[];b(new Set(t)),r.department_id&&v(r.department_id),window.scrollTo({top:0,behavior:"smooth"})},A=async r=>{if(window.confirm("Are you sure you want to delete this teacher?"))try{const{error:t}=await n.from("teachers").delete().eq("id",r);if(t)throw t;S(f.filter(a=>a.id!==r))}catch(t){console.error("Delete failed:",t),alert("Delete failed!")}},C=()=>{z(null),s({name:"",title:"Mr.",role:"teacher",department_id:"",primary_subject_id:"",qualification:"",email:"",phone:"",image_url:"",hierarchy_order:0}),b(new Set),v("")},k=j?h.filter(r=>r.department_id===j):h;return e.jsxs("div",{className:"admin-page",children:[e.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"2rem"},children:e.jsxs("div",{children:[e.jsx("h1",{children:"Teachers Management"}),e.jsx("p",{style:{color:"#6b7280"},children:"Add, edit, or remove school teachers and assign their subjects."})]})}),e.jsxs("div",{style:{background:"white",padding:"2rem",borderRadius:"12px",boxShadow:"0 4px 6px -1px rgba(0,0,0,0.1)",marginBottom:"3rem"},children:[e.jsxs("h3",{style:{fontSize:"1.25rem",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[c?e.jsx(B,{size:20}):e.jsx(U,{size:20}),c?"Edit Teacher":"Add New Teacher"]}),e.jsxs("form",{onSubmit:W,style:{display:"grid",gap:"2rem"},children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1.5rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500"},children:"Title"}),e.jsxs("select",{value:i.title,onChange:r=>s({...i,title:r.target.value}),style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"8px"},children:[e.jsx("option",{value:"Mr.",children:"Mr."}),e.jsx("option",{value:"Mrs.",children:"Mrs."}),e.jsx("option",{value:"Ms.",children:"Ms."}),e.jsx("option",{value:"Dr.",children:"Dr."}),e.jsx("option",{value:"Rev.",children:"Rev."}),e.jsx("option",{value:"Br.",children:"Br."}),e.jsx("option",{value:"Sr.",children:"Sr."})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500"},children:"Full Name"}),e.jsx("input",{type:"text",placeholder:"e.g. John Okello",value:i.name,onChange:r=>s({...i,name:r.target.value}),style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"8px"},required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500"},children:"Role"}),e.jsxs("select",{value:i.role,onChange:r=>s({...i,role:r.target.value}),style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"8px"},children:[e.jsx("option",{value:"teacher",children:"Teacher"}),e.jsx("option",{value:"hod",children:"Head of Department (HOD)"}),e.jsx("option",{value:"admin",children:"Administration"})]})]})]}),e.jsxs("div",{style:{borderTop:"1px solid #f3f4f6",paddingTop:"1.5rem"},children:[e.jsxs("h4",{style:{marginBottom:"1rem",fontSize:"1rem",color:"#374151",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(R,{size:18})," Assignment & Subjects"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1.5rem",marginBottom:"1.5rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500"},children:"Main Department"}),e.jsxs("select",{value:i.department_id,onChange:r=>s({...i,department_id:r.target.value}),style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"8px"},required:!0,children:[e.jsx("option",{value:"",children:"Select Department"}),y.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500"},children:"Primary Subject (The VIP)"}),e.jsxs("select",{value:i.primary_subject_id,onChange:r=>s({...i,primary_subject_id:r.target.value}),style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"8px",backgroundColor:"#fffbeb"},disabled:m.size===0,children:[e.jsx("option",{value:"",children:m.size===0?"Select subjects first ->":"Select Primary..."}),Array.from(m).map(r=>{const t=h.find(a=>a.id===r);return t?e.jsx("option",{value:t.id,children:t.name},t.id):null})]})]})]}),e.jsxs("div",{style:{background:"#f9fafb",padding:"1.5rem",borderRadius:"12px",border:"1px solid #e5e7eb"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("label",{style:{fontSize:"0.875rem",fontWeight:"600",color:"#374151"},children:"Select Subjects (Shopping Cart)"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(H,{size:14,color:"#6b7280"}),e.jsxs("select",{value:j,onChange:r=>v(r.target.value),style:{padding:"0.4rem",fontSize:"0.85rem",borderRadius:"6px",border:"1px solid #d1d5db"},children:[e.jsx("option",{value:"",children:"All Departments"}),y.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(140px, 1fr))",gap:"0.75rem",maxHeight:"200px",overflowY:"auto"},children:k.length===0?e.jsx("p",{style:{color:"#9ca3af",fontSize:"0.9rem",fontStyle:"italic"},children:"No subjects found in this department."}):k.map(r=>e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.9rem",cursor:"pointer",padding:"0.25rem"},children:[e.jsx("input",{type:"checkbox",checked:m.has(r.id),onChange:()=>N(r.id),style:{accentColor:"var(--color-primary)"}}),r.name]},r.id))})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"1.5rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500"},children:"Qualification"}),e.jsx("input",{type:"text",placeholder:"e.g. B.Sc Education",value:i.qualification,onChange:r=>s({...i,qualification:r.target.value}),style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"8px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500"},children:"Email Address"}),e.jsx("input",{type:"email",placeholder:"name@bugisuhigh.ac.ug",value:i.email,onChange:r=>s({...i,email:r.target.value}),style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"8px"}})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500"},children:"Phone Number"}),e.jsx("input",{type:"text",placeholder:"+256...",value:i.phone,onChange:r=>s({...i,phone:r.target.value}),style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"8px"}})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1.5rem"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",fontSize:"0.875rem",fontWeight:"500"},children:"Hierarchy Order (Priority)"}),e.jsx("input",{type:"number",value:i.hierarchy_order,onChange:r=>s({...i,hierarchy_order:parseInt(r.target.value)||0}),style:{width:"100%",padding:"0.75rem",border:"1px solid #d1d5db",borderRadius:"8px"}})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1.5rem"},children:[e.jsx("div",{style:{width:"60px",height:"60px",borderRadius:"50%",background:"#f3f4f6",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",border:"2px solid #e5e7eb",flexShrink:0},children:i.image_url?e.jsx("img",{src:i.image_url,alt:"Preview",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx(R,{size:24,color:"#9ca3af"})}),e.jsx("div",{style:{flex:1},children:e.jsxs("label",{className:"btn btn-outline",style:{cursor:g?"wait":"pointer",display:"inline-flex",alignItems:"center",gap:"0.5rem",width:"100%",justifyContent:"center"},children:[e.jsx($,{size:16}),g?"...":"Upload Photo",e.jsx("input",{type:"file",onChange:P,style:{display:"none"},accept:"image/*",disabled:g})]})})]})]}),e.jsxs("div",{style:{display:"flex",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("button",{type:"submit",className:"btn btn-primary",style:{display:"inline-flex",alignItems:"center",gap:"0.5rem"},disabled:g,children:[e.jsx(L,{size:18}),c?"Update Teacher":"Add Teacher"]}),c&&e.jsxs("button",{type:"button",onClick:C,className:"btn btn-outline",style:{display:"inline-flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx(F,{size:18})," Cancel"]})]})]})]}),e.jsx("h2",{style:{fontSize:"1.5rem",marginBottom:"1.5rem"},children:"Our Team"}),M?e.jsx("p",{children:"Loading teachers list..."}):f.length===0?e.jsx("div",{style:{textAlign:"center",padding:"3rem",background:"#f9fafb",borderRadius:"12px",border:"2px dashed #e5e7eb"},children:e.jsx("p",{style:{color:"#6b7280"},children:"No teachers added yet."})}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"1.5rem"},children:f.map(r=>{var t,a;return e.jsx("div",{style:{background:"white",borderRadius:"12px",overflow:"hidden",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",border:"1px solid #f3f4f6",transition:"transform 0.2s",position:"relative"},children:e.jsxs("div",{style:{display:"flex",padding:"1rem",alignItems:"center",gap:"1rem"},children:[e.jsx("img",{src:r.image_url||"https://via.placeholder.com/150",alt:r.name,style:{width:"60px",height:"60px",borderRadius:"50%",objectFit:"cover"}}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsxs("h4",{style:{margin:0,fontSize:"1rem",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[r.title," ",r.name]}),r.role==="hod"&&e.jsx("span",{style:{fontSize:"0.6rem",background:"#fee2e2",color:"#dc2626",padding:"2px 6px",borderRadius:"4px",fontWeight:"bold",textTransform:"uppercase"},children:"HOD"})]}),e.jsxs("p",{style:{margin:"2px 0",fontSize:"0.75rem",color:"#6b7280"},children:[((t=y.find(o=>o.id===r.department_id))==null?void 0:t.name)||"No Dept",r.primary_subject_id&&` â€¢ ${(a=h.find(o=>o.id===r.primary_subject_id))==null?void 0:a.name}`]}),e.jsxs("div",{style:{display:"flex",gap:"0.75rem",marginTop:"0.4rem"},children:[r.email&&e.jsx(J,{size:12,color:"#9ca3af"}),r.phone&&e.jsx(O,{size:12,color:"#9ca3af"}),e.jsxs("span",{style:{fontSize:"0.65rem",color:"#9ca3af"},children:["Order: ",r.hierarchy_order]})]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:[e.jsx("button",{onClick:()=>q(r),style:{background:"none",border:"none",cursor:"pointer",color:"var(--color-primary)",padding:"4px"},title:"Edit",children:e.jsx(B,{size:18})}),e.jsx("button",{onClick:()=>A(r.id),style:{background:"none",border:"none",cursor:"pointer",color:"#ef4444",padding:"4px"},title:"Delete",children:e.jsx(Q,{size:18})})]})]})},r.id)})})]})};export{re as default};
