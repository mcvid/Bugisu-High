import{r as n,s as E,j as e,U as O,a as P,m as v,S as T,p as I,G,P as J}from"./index-EH-KDdP-.js";import{T as B}from"./ThreeDCarousel-DopmukYz.js";import{A}from"./index-CAtil0is.js";import{M as Q}from"./mail-kSsI-FuV.js";import"./chevron-left-GT57DOTz.js";const Y=()=>{var R;const[i,w]=n.useState([]),[l,k]=n.useState([]),[m,$]=n.useState([]),[r,y]=n.useState(null),[x,p]=n.useState(null),[u,_]=n.useState(""),[L,q]=n.useState(!0),[M,F]=n.useState(null);n.useEffect(()=>{H()},[]);const H=async()=>{try{const[s,a,t,d]=await Promise.all([E.from("departments").select("*").order("sort_order",{ascending:!0}),E.from("subjects").select("*").order("name"),E.from("teachers").select("*"),E.from("teacher_subjects").select("teacher_id, subject_id, role")]);if(s.error)throw new Error("Depts: "+s.error.message);if(a.error)throw new Error("Subjects: "+a.error.message);if(t.error)throw new Error("Teachers: "+t.error.message);if(d.error)throw new Error("TeacherSubjects: "+d.error.message);const h=(t.data||[]).map(o=>{const c=(d.data||[]).filter(j=>j.teacher_id===o.id),g={};return c.forEach(j=>g[j.subject_id]=j.role||"teacher"),{...o,subject_ids:c.map(j=>j.subject_id),subject_roles:g}}).filter(o=>o);w(s.data||[]),k(a.data||[]),$(h)}catch(s){console.error("Error fetching departments data:",s),F(s.message)}finally{q(!1)}},f=n.useMemo(()=>l.find(s=>s.id===r),[l,r]),C=n.useMemo(()=>{let s=m;return r&&(s=s.filter(a=>{var t;return(t=a.subject_ids)==null?void 0:t.includes(r)})),u&&(s=s.filter(a=>a.name.toLowerCase().includes(u.toLowerCase()))),s},[m,r,u]),b=n.useMemo(()=>C.find(s=>s.role==="hod"),[C]),D=n.useMemo(()=>C.filter(s=>s.id!==(b==null?void 0:b.id)),[C,b]),N=n.useMemo(()=>{const s={};return m.forEach(a=>{a.department_id&&(s[a.department_id]||(s[a.department_id]=new Set),l.filter(d=>{var h;return(h=a.subject_ids)==null?void 0:h.includes(d.id)}).forEach(d=>s[a.department_id].add(JSON.stringify(d))))}),Object.keys(s).forEach(a=>{s[a]=Array.from(s[a]).map(t=>JSON.parse(t))}),s},[m,l]);return L?e.jsx("div",{className:"departments-page flex items-center justify-center pt-24",children:e.jsx("div",{className:"w-10 h-10 border-4 border-slate-200 border-t-red-600 rounded-full animate-spin"})}):M?e.jsxs("div",{className:"departments-page flex flex-col items-center justify-center pt-24 px-4 text-center",children:[e.jsx("div",{className:"text-red-600 text-xl font-bold mb-4",children:"Something went wrong!"}),e.jsx("div",{className:"bg-red-50 border border-red-200 p-4 rounded-lg max-w-lg text-slate-800",children:M}),e.jsx("button",{onClick:()=>window.location.reload(),className:"mt-6 px-6 py-2 bg-slate-900 text-white rounded-full text-sm font-bold uppercase tracking-wider hover:bg-slate-800 transition-colors",children:"Retry"})]}):e.jsxs("main",{className:"departments-page pt-24",children:[e.jsxs("div",{className:"departments-container",children:[e.jsxs("aside",{className:"dept-sidebar",children:[e.jsx("div",{className:"sidebar-header",children:e.jsxs("button",{onClick:()=>{y(null),p(null)},className:`all-staff-btn ${r?"":"active"}`,children:[e.jsx(O,{size:18}),e.jsx("span",{children:"All Staff"})]})}),e.jsx("div",{className:"sidebar-content",children:i.map(s=>{var h,o;const a=x===s.id,t=l.find(c=>c.id===r),d=t&&((h=N[s.id])==null?void 0:h.some(c=>c.name===t.name));return e.jsxs("div",{className:"dept-nav-group",children:[e.jsxs("button",{onClick:()=>p(a?null:s.id),className:`dept-nav-header ${d||a?"active":""} ${a?"expanded":""}`,children:[e.jsx("h4",{children:s.name}),e.jsx(P,{size:20,className:`chevron-icon ${a?"rotate":""}`})]}),e.jsx(A,{children:a&&e.jsx(v.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"overflow-hidden",children:e.jsxs("div",{className:"subject-nav-list",children:[(o=N[s.id])==null?void 0:o.map(c=>{var g,j;return e.jsxs("button",{onClick:()=>y(c.id),className:`subject-nav-btn ${((g=l.find(z=>z.id===r))==null?void 0:g.name)===c.name?"active":""}`,children:[((j=l.find(z=>z.id===r))==null?void 0:j.name)===c.name&&e.jsx(v.div,{layoutId:"active-indicator",className:"active-indicator"}),c.name]},c.id)}),(!N[s.id]||N[s.id].length===0)&&e.jsx("div",{className:"empty-state",style:{padding:"1rem",fontSize:"0.75rem"},children:"No subjects listed"})]})})})]},s.id)})})]}),e.jsxs("div",{className:"mobile-nav",children:[e.jsxs("div",{className:"mobile-dept-scroll no-scrollbar",children:[e.jsx("button",{onClick:()=>{y(null),p(null)},className:`mobile-dept-btn ${r?"":"active"}`,children:"All Staff"}),i.map(s=>{var h;const a=x===s.id,t=l.find(o=>o.id===r),d=t&&((h=N[s.id])==null?void 0:h.some(o=>o.name===t.name))||a;return e.jsx("button",{onClick:()=>p(x===s.id?null:s.id),className:`mobile-dept-btn ${d?"active":""}`,children:s.name},s.id)})]}),e.jsx(A,{children:x&&e.jsx(v.div,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},className:"mobile-subject-scroll no-scrollbar",children:(R=N[x])==null?void 0:R.map(s=>{var a;return e.jsx("button",{onClick:()=>y(s.id),className:`mobile-subject-btn ${((a=l.find(t=>t.id===r))==null?void 0:a.name)===s.name?"active":""}`,children:s.name},s.id)})})}),e.jsx("div",{className:"mobile-search-wrapper",children:e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(T,{className:"search-icon",size:16}),e.jsx("input",{type:"text",placeholder:"Search teacher...",value:u,onChange:s=>_(s.target.value),className:"dept-search-input"})]})})]}),e.jsx("div",{className:"departments-main",children:e.jsxs("div",{className:"content-inner",children:[e.jsx("div",{className:"desktop-search search-section",children:e.jsxs("div",{className:"search-input-wrapper",children:[e.jsx(T,{className:"search-icon",size:20}),e.jsx("input",{type:"text",placeholder:"Browse teachers by name...",value:u,onChange:s=>_(s.target.value),className:"dept-search-input"})]})}),e.jsx("div",{className:"main-content-results",children:e.jsx(A,{mode:"wait",children:r?e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"results-section",children:[e.jsxs("div",{className:"subject-header",children:[e.jsx("h1",{className:"subject-title",children:f==null?void 0:f.name}),e.jsx("span",{className:"hierarchy-badge",children:"Academic Faculty"})]}),b&&e.jsxs("div",{className:"hod-container",children:[e.jsx("span",{className:"hod-label",children:"Head of Subject"}),e.jsx(S,{teacher:b,isLarge:!0,showRole:!0,subjectName:f==null?void 0:f.name}),e.jsx("div",{className:"connector-line"})]}),e.jsxs("div",{className:"staff-section",children:[e.jsx("span",{className:"staff-label",children:"Department Staff"}),D.length===0?e.jsx("p",{className:"empty-state",children:"No other staff members listed for this subject yet."}):e.jsxs("div",{className:"teacher-grid",children:[e.jsx("div",{className:"mobile-only-carousel",style:{gridColumn:"1 / -1"},children:e.jsx(B,{items:D.map(s=>e.jsx(S,{teacher:s,showRole:s.role==="hod",availableSubjects:l},s.id))})}),D.map(s=>e.jsx("div",{className:"desktop-only-grid",children:e.jsx(S,{teacher:s,availableSubjects:l})},s.id))]})]})]},r):e.jsxs(v.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"results-section",children:[e.jsxs("div",{className:"section-header",children:[e.jsx("h1",{className:"section-title",children:"Academic Leadership"}),e.jsx("div",{className:"title-underline"}),e.jsx("p",{className:"section-subtitle",children:"Heads of Departments"})]}),e.jsxs("div",{className:"all-departments-list",style:{display:"flex",flexDirection:"column",gap:"4rem"},children:[i.map(s=>{const a=m.filter(t=>t.department_id===s.id&&t.role==="hod");return a.length===0?null:e.jsxs("div",{className:"dept-group-section",children:[e.jsx("div",{className:"dept-header-row",style:{marginBottom:"1.5rem",borderBottom:"1px solid #e2e8f0",paddingBottom:"0.5rem"},children:e.jsx("h2",{style:{fontSize:"1.8rem",fontFamily:"var(--font-serif)",color:"var(--color-primary)"},children:s.name})}),e.jsx("div",{className:"desktop-only-grid",style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(300px, 1fr))",gap:"2rem",justifyItems:"start"},children:a.map(t=>e.jsx("div",{style:{width:"100%",maxWidth:"400px"},children:e.jsx(S,{teacher:t,showRole:!0,availableSubjects:l})},t.id))}),e.jsx("div",{className:"mobile-only-carousel",children:e.jsx(B,{items:a.map(t=>e.jsx(S,{teacher:t,showRole:!0,availableSubjects:l},t.id))})})]},s.id)}),m.filter(s=>s.role==="hod").length===0&&e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"No Academic Leaders assigned yet."})})]})]},"all-leadership")})})]})})]}),e.jsx(I,{})]})},S=({teacher:i,isLarge:w=!1,showRole:l=!1,subjectName:k,availableSubjects:m})=>{const $=n.useMemo(()=>{if(!m)return[];const x=(i.subject_ids||(i.primary_subject_id?[i.primary_subject_id]:[])).map(p=>{var u;return(u=m.find(_=>_.id===p))==null?void 0:u.name}).filter(Boolean);return[...new Set(x)]},[i,m]),r=k||$.join(" & ")||"Faculty";return e.jsxs(v.div,{whileHover:{y:-5},className:`staff-card ${w?"large-card":""}`,children:[e.jsx("div",{className:"staff-card-image",children:i.image_url?e.jsx("img",{src:i.image_url,alt:i.name}):e.jsx("div",{className:"staff-placeholder",children:e.jsx(O,{size:w?64:48})})}),e.jsxs("div",{className:`staff-card-body ${l?"hod-bg":""}`,children:[e.jsxs("div",{className:"staff-info-header",children:[e.jsx("span",{className:"staff-subject-tag",children:l?`HOD ${r}`:r}),e.jsxs("h3",{className:"staff-name",children:[i.title," ",i.name]})]}),e.jsxs("div",{className:"staff-details",children:[i.qualification&&e.jsxs("div",{className:"staff-qualification",children:[e.jsx(G,{size:16}),e.jsx("span",{children:i.qualification})]}),e.jsxs("div",{className:"staff-actions",children:[i.email&&e.jsxs("a",{href:`mailto:${i.email}`,className:"staff-action-link",children:[e.jsx(Q,{size:14}),e.jsx("span",{className:"staff-action-text",children:"Email"})]}),i.phone&&e.jsxs("a",{href:`tel:${i.phone}`,className:"staff-action-link",children:[e.jsx(J,{size:14}),e.jsx("span",{className:"staff-action-text",children:"Call"})]})]})]})]})]})};export{Y as default};
