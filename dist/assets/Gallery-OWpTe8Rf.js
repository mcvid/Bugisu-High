import{r as n,R as C,j as e,X as E,s as S,f as _,C as L}from"./index-EH-KDdP-.js";import{O as k}from"./OptimizedImage-CWDuI0t_.js";import{U as T}from"./UniversalHero-BnkIybS5.js";import"./useQueries-CzAEryra.js";import"./chevron-left-GT57DOTz.js";const G=({images:i,currentIndex:a,onClose:l,onNext:p,onPrev:g,galleryTitle:j})=>{if(a===null||!i||i.length===0||!i[a])return null;const h=i[a],m=()=>{a<i.length-1&&p()},o=()=>{a>0&&g()},c=s=>{s.key==="Escape"&&l(),s.key==="ArrowRight"&&m(),s.key==="ArrowLeft"&&o()},[r,f]=n.useState(null),[u,v]=n.useState(null),b=50,y=s=>{v(null),f(s.targetTouches[0].clientX)},N=s=>v(s.targetTouches[0].clientX),t=()=>{if(!r||!u)return;const s=r-u,d=s>b,x=s<-b;d?m():x&&o()};return C.useEffect(()=>(document.addEventListener("keydown",c),document.body.style.overflow="hidden",()=>{document.removeEventListener("keydown",c),document.body.style.overflow="unset"}),[a]),e.jsxs("div",{className:"lightbox-overlay",onClick:l,onTouchStart:y,onTouchMove:N,onTouchEnd:t,children:[e.jsx("button",{className:"lightbox-close",onClick:l,children:e.jsx(E,{size:32})}),e.jsxs("div",{className:"lightbox-content",onClick:s=>s.stopPropagation(),children:[e.jsx("img",{src:h.image_url,alt:h.caption||`${j||"Gallery"} - Image ${a+1}`}),h.caption&&e.jsx("div",{className:"lightbox-caption",children:h.caption}),e.jsxs("div",{className:"lightbox-counter",children:[a+1," / ",i.length]})]}),a>0&&e.jsx("button",{className:"lightbox-nav lightbox-prev",onClick:o,children:"‹"}),a<i.length-1&&e.jsx("button",{className:"lightbox-nav lightbox-next",onClick:m,children:"›"})]})},z=()=>{const[i,a]=n.useState([]),[l,p]=n.useState(null),[g,j]=n.useState([]),[h,m]=n.useState(!0),[o,c]=n.useState(null),[r,f]=n.useState("all"),[u,v]=n.useState([]);n.useEffect(()=>{b()},[r]);const b=async()=>{try{m(!0);let t=S.from("galleries").select("*").order("event_date",{ascending:!1});r!=="all"&&(t=t.eq("category",r));const{data:s,error:d}=await t;if(d)throw d;a(s||[]);const x=[...new Set(s==null?void 0:s.map(w=>w.category).filter(Boolean))];v(x)}catch(t){console.error("Error fetching galleries:",t)}finally{m(!1)}},y=async t=>{try{const{data:s,error:d}=await S.from("gallery_images").select("*").eq("gallery_id",t).order("sort_order",{ascending:!0});if(d)throw d;j(s||[]),p(i.find(x=>x.id===t))}catch(s){console.error("Error fetching gallery images:",s)}},N=()=>{p(null),j([]),c(null)};return e.jsxs("div",{className:"section container gallery-page",children:[e.jsx(T,{pagePath:"/gallery",height:"35vh",showImage:!1,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("h1",{children:"School Gallery"}),e.jsx("p",{className:"page-subtitle",children:l?l.title:"A glimpse into life at Bugisu High School"})]})}),l?e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"back-btn",onClick:N,children:"← Back to Albums"}),l.description&&e.jsx("p",{className:"gallery-description",children:l.description}),g.length===0?e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"No images in this gallery yet."})}):e.jsx("div",{className:"gallery-grid",children:g.map((t,s)=>e.jsxs("div",{className:"gallery-item",onClick:()=>c(s),children:[e.jsx(k,{src:t.image_url,alt:t.caption||`${l.title} - Image ${s+1}`,aspectRatio:"1/1"}),t.caption&&e.jsx("div",{className:"gallery-overlay",children:e.jsx("span",{className:"gallery-title",children:t.caption})})]},t.id))})]}):e.jsxs(e.Fragment,{children:[u.length>0&&e.jsxs("div",{className:"category-filter",children:[e.jsx("button",{className:`filter-btn ${r==="all"?"active":""}`,onClick:()=>f("all"),children:"All"}),u.map(t=>e.jsx("button",{className:`filter-btn ${r===t?"active":""}`,onClick:()=>f(t),children:t},t))]}),h?e.jsxs("div",{className:"loading-state",children:[e.jsx("div",{className:"spinner"}),e.jsx("p",{children:"Loading galleries..."})]}):i.length===0?e.jsxs("div",{className:"empty-state",children:[e.jsx(_,{size:48,style:{color:"#94a3b8",marginBottom:"1rem"}}),e.jsx("p",{children:"No galleries available yet."})]}):e.jsx("div",{className:"albums-grid",children:i.map(t=>e.jsxs("div",{className:"album-card",onClick:()=>y(t.id),children:[e.jsxs("div",{className:"album-cover",children:[e.jsx(k,{src:t.cover_image_url||"https://images.unsplash.com/photo-1523050854058-8df90110c9f1?auto=format&fit=crop&q=80",alt:t.title,aspectRatio:"16/10"}),t.category&&e.jsx("span",{className:"album-category",children:t.category})]}),e.jsxs("div",{className:"album-info",children:[e.jsx("h3",{children:t.title}),t.description&&e.jsx("p",{className:"album-description",children:t.description}),t.event_date&&e.jsxs("div",{className:"album-date",children:[e.jsx(L,{size:14}),new Date(t.event_date).toLocaleDateString()]})]})]},t.id))})]}),o!==null&&e.jsx(G,{images:g,galleryTitle:l==null?void 0:l.title,currentIndex:o,onClose:()=>c(null),onNext:()=>c(o+1),onPrev:()=>c(o-1)})]})};export{z as default};
